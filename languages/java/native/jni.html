
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Compute Science Blog">
      
      
        <meta name="author" content="LiuZhiqiang(刘志强）">
      
      
        <link rel="canonical" href="https://xliuqq.github.io/csblog/languages/java/native/jni.html">
      
      
        <link rel="prev" href="index.html">
      
      
        <link rel="next" href="jni_demo.html">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>原理 - XLiu CS Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#jnijava-native-interface" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="XLiu CS Blog" class="md-header__button md-logo" aria-label="XLiu CS Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            XLiu CS Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              原理
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/xliuqq/csblog" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    xliuqq/csblog
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../index.html" class="md-tabs__link">
          
  
  
    
  
  博客

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../cloud/index.html" class="md-tabs__link">
          
  
  
    
  
  云原生

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../books/index.html" class="md-tabs__link">
          
  
  
    
  
  书籍

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../code_guide/design_principle.html" class="md-tabs__link">
          
  
  
    
  
  编程指南

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="index.html" class="md-tabs__link">
          
  
  
    
  
  编程语言

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../linux/basic.html" class="md-tabs__link">
          
  
  
    
  
  linux

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../web_backend/index.html" class="md-tabs__link">
          
  
  
    
  
  Web后端开发

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../cs/cs_basic.html" class="md-tabs__link">
          
  
  
    
  
  CS基础

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../courses/os_lab/index.html" class="md-tabs__link">
          
  
  
    
  
  课程

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../paper/go_concurrency_bugs.html" class="md-tabs__link">
          
  
  
    
  
  论文

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="XLiu CS Blog" class="md-nav__button md-logo" aria-label="XLiu CS Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    XLiu CS Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/xliuqq/csblog" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    xliuqq/csblog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    博客
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    博客
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tags.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    标签
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    归档
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    归档
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2024.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2024
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2023.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    分类
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    分类
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/hdfs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HDFS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/k8s.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    K8s
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/yarn.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Yarn
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/devops.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    devops
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/helm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    helm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/maven.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    maven
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/spark.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    spark
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/%E5%B9%B6%E5%8F%91.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    并发
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../cloud/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    云原生
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    云原生
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../cloud/virtualize/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    虚拟化
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    虚拟化
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/virtualize/lxcfs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    proc虚拟化和共享
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/virtualize/gpu.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    gpu虚拟化
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_2_4" id="__nav_2_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    moby(docker)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    moby(docker)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/virtualize/docker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/virtualize/docker_deploy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    部署配置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/virtualize/docker_cmds.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    使用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/virtualize/containerd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    containerd
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    k8s
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    k8s
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_1" >
        
          
          <label class="md-nav__link" for="__nav_2_3_1" id="__nav_2_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    架构与组件
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    架构与组件
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/k8s.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概述
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/kubelet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kubelet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/k8s_object.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    对象定义
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/k8s_resource.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    内置资源对象
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/pod_inplace_upgrade.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pod原地升级
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/config.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    常用配置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/cmds.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    命令使用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/go_client.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    goclient
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/ui_manager.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UI和管理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/log_arch.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    日志架构
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/k8s_security.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    安全机制
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_11" >
        
          
          <label class="md-nav__link" for="__nav_2_3_11" id="__nav_2_3_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    资源调度
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    资源调度
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/scheduler.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    调度策略
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/scheduler_plugin.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    调度策略
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_12" >
        
          
          <label class="md-nav__link" for="__nav_2_3_12" id="__nav_2_3_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    CRD
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    CRD
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/crd_index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概述
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/crd_kubebuilder.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kubebuilder
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/crd_java.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JavaOperator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/metrics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    指标监控
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/device_plugin.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    设备插件
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/garbage_collect.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    垃圾回收
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/webhook.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Wehhook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/network.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    网络模型
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/extend_csi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    存储模型
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_19" >
        
          
          <label class="md-nav__link" for="__nav_2_3_19" id="__nav_2_3_19_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    安装部署
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_19">
            <span class="md-nav__icon md-icon"></span>
            
  
    安装部署
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/deploy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    部署流程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/deploy_storage.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    存储部署
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/notes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    生产注意事项
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/k8s/release_compare.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    可选发行版
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/helm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    包管理Helm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/habor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    镜像仓库Habor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    无服务化
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    无服务化
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/serverless/serverless.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概述
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/serverless/knative.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    knative
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/serverless/openfaas.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    openfaas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    常用镜像
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    常用镜像
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/images/images.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    常用镜像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/images/web_centos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    浏览器centos
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/tools.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    镜像工具
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    云边系统
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    云边系统
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/cloud_edge/mqtt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    mqtt协议
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/cloud_edge/openyurt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    openyurt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/cloud_edge/kubeedge.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kubeedge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
        
          
          <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    项目
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    项目
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/projects/HAMi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    vGPU HAMI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/projects/fluid.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    数据编排Fluid
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/projects/istio.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    流量编排Istio
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/projects/kubevela.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    应用交付KubeVela
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../books/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    书籍
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    书籍
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../books/data_intensive_system_book/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    数据密集型系统设计
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    数据密集型系统设计
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/1_data_system_basic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    可靠、可扩展、可维护的应用系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/2_data_model_query_language.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    数据模型和查询语言
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/3_data_store_and_search.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    数据存储与检索
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/4_encoding_and_evolution.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    编码与演化
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/part2_distributed_data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第二部分：分布式数据
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/5_replication.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    复制
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/6_partitions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    分区
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/7_transaction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    事务
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/8_trouble_in_distributed_system.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    分布式系统的麻烦
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/9_consistency_consensus.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    一致性与共识
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/part3_derived_data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第三部分：衍生数据
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/10_batch_processing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第十章：批处理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/11_streaming_processing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第十一章：流处理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/data_intensive_system_book/12_the_future.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第十二章：数据系统的未来
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    编程指南
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    编程指南
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_principle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    设计原则
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../code_guide/design_pattern/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    设计模式
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    设计模式
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    创建型模式
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    创建型模式
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/factory.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    工厂模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/abstract_factory.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    抽象工厂
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/singleton.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    单例
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/builder.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    构造者模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/prototype.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    原型模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_3" id="__nav_4_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    结构型模式
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    结构型模式
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/adapter.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    适配器模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/bridge.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    桥接模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/composite.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    组合模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/decorator.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    装饰模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/facade.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    外观模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/flyweight.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    享元模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/proxy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    代理模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_4" >
        
          
          <label class="md-nav__link" for="__nav_4_2_4" id="__nav_4_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    行为型模式
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    行为型模式
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/chain.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    职责链模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/command.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    命令模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/interpret.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    解释器模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/iterator.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    迭代器模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/medium.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    中介者模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/memento.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    备忘录模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/observer.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    观察者模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/state.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    状态模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/strategy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    策略模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/template.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    模板方法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/visitor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    访问者模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/design_pattern/container_distributed.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    分布式应用设计模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/clean_code.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    整洁代码
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../code_guide/algs/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    算法
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    算法
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/algs/hash.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    散列算法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/algs/bloom_filter.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    布隆过滤器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    数据结构
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    数据结构
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/data_structure/array.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    数组
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/data_structure/list.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    链表
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/data_structure/queue.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    队列
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/data_structure/hashmap.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hash表
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../code_guide/data_structure/tree.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    树
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    编程语言
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    编程语言
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Java
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Java
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Native
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1" id="__nav_5_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Native
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_2" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1_1_2" id="__nav_5_1_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    JNI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    JNI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    原理
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="jni.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    原理
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        设计概述
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="设计概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jnijnienv" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI接口函数和指针(JNIEnv*)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        编译、加载和链接本地方法
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="编译、加载和链接本地方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        本机方法参数
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java" class="md-nav__link">
    <span class="md-ellipsis">
      
        引用Java对象
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Java异常
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Java异常">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        异常和错误代码
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        异步异常
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        异常处理
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jni" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI 类型和数据结构
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JNI 类型和数据结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        基本类型
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        引用类型
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id" class="md-nav__link">
    <span class="md-ellipsis">
      
        字段和方法ID
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        值类型
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        类型签名
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utf-8" class="md-nav__link">
    <span class="md-ellipsis">
      
        修改后的UTF-8字符串
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jni_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI 函数
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JNI 函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        常量
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        版本信息
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        类操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        模块操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        线程操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        异常
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        全局和局部引用
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        弱全局引用
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        对象操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      
        访问对象的字段
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      
        调用实例方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      
        访问静态字段
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      
        调用静态方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      
        字符串操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      
        数组操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      
        注册本地方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      
        监视器操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nio" class="md-nav__link">
    <span class="md-ellipsis">
      
        NIO 支持
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      
        反射支持
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vm" class="md-nav__link">
    <span class="md-ellipsis">
      
        VM 接口
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      
        调用 API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="调用 API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      
        概述
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      
        创建虚拟机
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      
        附加到虚拟机
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      
        从虚拟机分离
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      
        终止虚拟机
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      
        库和版本管理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="库和版本管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态链接库支持
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      
        库生命周期函数挂钩
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jni_onload" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_OnLoad
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jni_onunload" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_OnUnload
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jni_onload_l" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_OnLoad_L
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jni_onunload_l" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_OnUnload_L
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        调用API函数
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="调用API函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jni_getdefaultjavavminitargs" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_GetDefaultJavaVMInitArgs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jni_getcreatedjavavms" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_GetCreatedJavaVMs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jni_createjavavm" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_CreateJavaVM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#destroyjavavm" class="md-nav__link">
    <span class="md-ellipsis">
      
        DestroyJavaVM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attachcurrentthread" class="md-nav__link">
    <span class="md-ellipsis">
      
        AttachCurrentThread
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attachcurrentthreadasdaemon" class="md-nav__link">
    <span class="md-ellipsis">
      
        AttachCurrentThreadAsDaemon
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detachcurrentthread" class="md-nav__link">
    <span class="md-ellipsis">
      
        DetachCurrentThread
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getenv" class="md-nav__link">
    <span class="md-ellipsis">
      
        GetEnv
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="jni_demo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    示例
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="jnr.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JNR
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jmh.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基准测试
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../packages/tools.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    工具包
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    C和C++
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    C和C++
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ccpp/basic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ccpp/class.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    类
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ccpp/concurrency.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    并发
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ccpp/debug.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    调试
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ccpp/call_python.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CallPython
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ccpp/abi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ABI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ccpp/gcc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    gcc
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ccpp/make.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    make
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../libffi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ffi
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../unicode.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    unicode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ziju.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    语言自举
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    linux
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/basic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/shell_programming.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    shell编程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/tuning.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    性能调试命令
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/bash.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    bash
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/chmod.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    chmod
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/chroot.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    chroot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/binutils.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    gnu工具
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/firewall.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    防火墙
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/namespace.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    名空间
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/cgroup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cgroup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/limit_process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    进程的限制
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/systemctl.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    systemctl
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/log_and_rotate.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    日志管理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/process_snapshot.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    进程快照
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/acls.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    acls
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/network.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    网络
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/fs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    文件系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/zero_copy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    零拷贝
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/yum.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    源配置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../web_backend/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Web后端开发
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Web后端开发
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../web_backend/aop_java.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    切面编程(Java)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../web_backend/cache.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    缓存
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    CS基础
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    CS基础
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/cs_basic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/cs_os.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    操作系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../cs/network/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    网络
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    网络
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/network/network.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    网络层协议
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/network/trans_protocols.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    传输层协议
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/network/http.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HTTP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/network/intranet_penetration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    内网穿透
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/network/LVS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LVS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    课程
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    课程
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../courses/os_lab/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    操作系统设计与实现(2023)
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9_1" id="__nav_9_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    操作系统设计与实现(2023)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/01-os_introduction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.操作系统概述
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/02-os_appview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2.应用视角的操作系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/03-os_hardware_view.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3.硬件视角的操作系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/04-os_python_modeling.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4.Python 建模操作系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/05_multi_cpu_programming.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5.多处理器编程：从入门到放弃
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/06_concurrent_control_basic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6.应用视角的操作系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/07_concurrent_control_mutex.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7.并发控制：互斥
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/08_debug_and_action.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8.调试理论与实践
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/09_sync_condition.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9.并发控制：同步（条件变量）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/10_sync_semphore.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10.并发控制：同步（信号量）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/11_concurrent_in_real_world.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11.真实世界的并发编程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/12_concurrent_bug_category.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12.并发BUG分类
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/13_concurrent_bug_defense.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13.并发 Bug 的应对
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/14_multi_cpu_and_interrupt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14.多处理器系统与中断机制
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/15_kernel_thread_and_process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15.操作系统上的进程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/16_application_in_linux.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16.Linux 操作系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/17_hack_linux_process_address.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17.Linux 进程的地址空间
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/18_os_lab_live_guide.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18.操作系统实验生存指南
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/19_system_call_and_shell.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19.系统调用和 UNIX Shell
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/20-c_standard_lib.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20.C标准库和实现
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/21-22-executable_files_loading.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21-22.可执行文件与加载
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/23_application_of_state_machine.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    23.状态机模型的应用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/24_impletation_of_os_process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    24.操作系统进程的实现
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/25_store_device.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    25.存储设备原理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/26_input_output_device.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    26.输入输出设备
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/27_device_driver_and_filesystem.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    27.设备驱动程序与文件系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/28_FAT_UNIX_filesystem.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    28.FAT 和 UNIX 文件系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/29_available_durable_data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    29.持久数据的可靠性
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/os_lab/30_summarize.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    30.课程总结
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    论文
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    论文
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/go_concurrency_bugs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    go并发bugs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/scalability_but_at_what_cost.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    可扩展性的代价
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper/large_fs_for_containers.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    大规模容器文件系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        设计概述
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="设计概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jnijnienv" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI接口函数和指针(JNIEnv*)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        编译、加载和链接本地方法
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="编译、加载和链接本地方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        本机方法参数
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java" class="md-nav__link">
    <span class="md-ellipsis">
      
        引用Java对象
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Java异常
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Java异常">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        异常和错误代码
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        异步异常
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        异常处理
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jni" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI 类型和数据结构
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JNI 类型和数据结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        基本类型
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        引用类型
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id" class="md-nav__link">
    <span class="md-ellipsis">
      
        字段和方法ID
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        值类型
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        类型签名
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utf-8" class="md-nav__link">
    <span class="md-ellipsis">
      
        修改后的UTF-8字符串
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jni_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI 函数
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JNI 函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        常量
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        版本信息
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        类操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        模块操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        线程操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        异常
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        全局和局部引用
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        弱全局引用
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        对象操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      
        访问对象的字段
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      
        调用实例方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      
        访问静态字段
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      
        调用静态方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      
        字符串操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      
        数组操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      
        注册本地方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      
        监视器操作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nio" class="md-nav__link">
    <span class="md-ellipsis">
      
        NIO 支持
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      
        反射支持
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vm" class="md-nav__link">
    <span class="md-ellipsis">
      
        VM 接口
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      
        调用 API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="调用 API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      
        概述
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      
        创建虚拟机
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      
        附加到虚拟机
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      
        从虚拟机分离
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      
        终止虚拟机
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      
        库和版本管理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="库和版本管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      
        静态链接库支持
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      
        库生命周期函数挂钩
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jni_onload" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_OnLoad
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jni_onunload" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_OnUnload
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jni_onload_l" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_OnLoad_L
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jni_onunload_l" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_OnUnload_L
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        调用API函数
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="调用API函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jni_getdefaultjavavminitargs" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_GetDefaultJavaVMInitArgs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jni_getcreatedjavavms" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_GetCreatedJavaVMs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jni_createjavavm" class="md-nav__link">
    <span class="md-ellipsis">
      
        JNI_CreateJavaVM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#destroyjavavm" class="md-nav__link">
    <span class="md-ellipsis">
      
        DestroyJavaVM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attachcurrentthread" class="md-nav__link">
    <span class="md-ellipsis">
      
        AttachCurrentThread
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attachcurrentthreadasdaemon" class="md-nav__link">
    <span class="md-ellipsis">
      
        AttachCurrentThreadAsDaemon
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detachcurrentthread" class="md-nav__link">
    <span class="md-ellipsis">
      
        DetachCurrentThread
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getenv" class="md-nav__link">
    <span class="md-ellipsis">
      
        GetEnv
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="jnijava-native-interface">JNI(Java Native Interface)</h1>
<blockquote>
<p>基于<a href="https://java.cunzaima.cn/jdk21/doc-zh/specs/jni/invocation.html">JDK21</a>，示例见 <a href="jni_demo.html">Demo</a>。</p>
</blockquote>
<p>何时需要使用Java本地方法：</p>
<ul>
<li>标准Java类库不支持应用程序所需的平台相关功能。</li>
<li>您已经有一个用另一种语言编写的库，并希望通过JNI使其可供Java代码访问。</li>
<li>您想要在较低级别语言（如汇编）中实现一小部分时间关键代码。</li>
</ul>
<p><strong>JNI_OnLoad可以和JNIEnv的registerNatives函数结合起来，实现动态的函数替换。</strong></p>
<h2 id="_1">设计概述</h2>
<h3 id="jnijnienv">JNI接口函数和指针(JNIEnv*)</h3>
<p>本地代码通过调用JNI函数访问Java虚拟机功能。JNI函数通过一个<strong><em>接口指针</em></strong>提供。</p>
<ul>
<li>接口指针是一个指向指针的指针。该指针指向一个指针数组，每个指针指向一个接口函数。每个接口函数都位于数组内的预定义偏移量处。</li>
</ul>
<p><img alt="接口指针" src=".pics/jni/interface-pointer.gif" /></p>
<p>JNI接口指针<font color='red'><strong>仅在当前线程</strong></font>中有效。因此，本地方法不得将接口指针从一个线程传递到另一个线程。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="cm">/* 获取Java字符串的C副本 */</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetStringUTFChars</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="cm">/** C++ 源代码中消失了额外的间接级别和接口指针参数 */</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">-&gt;</span><span class="n">GetStringUTFChars</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</code></pre></div>
<h3 id="_2">编译、加载和链接本地方法</h3>
<blockquote>
<p>由于Java虚拟机是多线程的，本地库也应使用<strong>支持多线程的本地编译器</strong>进行编译和链接。</p>
<ul>
<li>GCC 的 -D_REENTRANT</li>
</ul>
</blockquote>
<p>本地方法通过<code>System.loadLibrary</code>方法加载。虚拟机在内部为<strong>每个类加载器</strong>维护一个已加载本地库的列表。</p>
<ul>
<li>Linux系统将名称<code>p_q_r_A</code>转换为<code>libp_q_r_A.so</code>，而Windows系统将相同的<code>p_q_r_A</code>名称转换为<code>p_q_r_A.dll</code>。</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">p.q.r</span><span class="p">;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kd">class</span> <span class="nc">A</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="kd">native</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="p">);</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">loadLibrary</span><span class="p">(</span><span class="s">&quot;p_q_r_A&quot;</span><span class="p">);</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="p">}</span>
</code></pre></div>
<p>本机方法和接口API都遵循给定平台上的标准库调用约定。例如，UNIX系统使用C调用约定，而Win32系统使用__stdcall。</p>
<h4 id="_3">本机方法参数</h4>
<p>JNI接口指针是本机方法的第一个参数。JNI接口指针的类型为<em>JNIEnv</em>。</p>
<p>第二个参数取决于本机方法是静态的还是非静态的。非静态本机方法的第二个参数是对对象的引用。静态本机方法的第二个参数是对其Java类的引用。</p>
<p>其余参数对应于常规Java方法参数。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">jdouble</span><span class="w"> </span><span class="n">Java_p_q_r_A_f__ILjava_lang_String_2</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">     </span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w">        </span><span class="cm">/* 接口指针 */</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">     </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w">        </span><span class="cm">/* &quot;this&quot;指针 */</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">     </span><span class="n">jint</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w">             </span><span class="cm">/* 参数＃1 */</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">     </span><span class="n">jstring</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w">          </span><span class="cm">/* 参数＃2 */</span><span class="w">   </span>
</code></pre></div>
<h3 id="java">引用Java对象</h3>
<blockquote>
<p>原始类型，如整数、字符等，在Java和本机代码之间进行复制。另一方面，任意Java对象是通过引用传递的。虚拟机必须跟踪所有传递给本机代码的对象，以便这些对象不会被垃圾回收器释放。</p>
</blockquote>
<p>JNI 支持3中不透明的引用：<strong>局部(local)引用</strong>、<strong>全局(global)引用</strong>和<strong>弱全局引用</strong>。</p>
<ul>
<li>局部引用在本机方法调用期间有效，并在<font color='red'><strong>本机方法返回后</strong></font>自动释放，局部引用仅在<strong>创建它们的线程中</strong>有效。</li>
<li>全局引用保持有效，直到显式释放为止。从局部引用创建全局引用。</li>
</ul>
<p>对象作为<strong>局部引用传递给本机</strong>方法。所有由 <strong>JNI 函数返回的Java对象都是局部</strong>引用。</p>
<ul>
<li>本机方法可以将局部或全局引用作为其结果返回给虚拟机。</li>
</ul>
<p>有时程序员应显式释放局部引用：</p>
<ul>
<li>在其余计算中不再使用该对象时，大的Java对象的局部引用将阻止垃圾回收对象；</li>
<li>本机方法创建大量局部引用，尽管并非所有引用同时使用，创建太多局部引用可能导致系统内存不足。</li>
</ul>
<p>弱引用对象</p>
<ul>
<li>一个局部或者全局引用，使所提及的对象不能被垃圾回收。而弱全局引用，则允许提及的对象进行垃圾回收。</li>
</ul>
<p>释放引用：</p>
<ul>
<li><strong>基本数据类型是不需要释放</strong>，如 jint , jlong , jchar 等等。</li>
<li>需要释放的是引用数据类型，当然也包括数组。如：jstring, jobject, j***Array, jclass 等。</li>
<li><code>jmethodID</code>和<code>jfieldID</code>不是引用类型，不需要被释放；</li>
</ul>
<p>局部引用默认只有当<strong>本地函数返回Java（当Java调用native）</strong>或<strong>调用线程detach JVM（native调用Java）</strong>时才会被GC。</p>
<p><font color='red'>对于C++ call Java时创建的 global reference和 local reference 创建，需要定义其释放之处；</font></p>
<blockquote>
<p>注：HotSpotVM：-XX:MaxJNILocalCapacity flag (default: 65536)。当前没有测试出来，Local references 溢出的情况；(JDK 8)</p>
</blockquote>
<h3 id="java_1">Java异常</h3>
<p>JNI允许本地方法引发任意Java异常。本地代码也可以处理未处理的Java异常。未处理的Java异常将传播回VM。</p>
<p><strong>本地代码中调用某个JNI接口时如果发生了异常，后续的本地代码不会立即停止执行，而会继续往下执行后面的代码。</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1">// 如果这里出现问题，则会出现问题，后续执行异常</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">jauthority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="p">.</span><span class="n">newStringUTF</span><span class="p">(</span><span class="n">authority</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;authority&quot;</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">env</span><span class="o">-&gt;</span><span class="n">DeleteLocalRef</span><span class="p">(</span><span class="n">jauthority</span><span class="p">);</span>
</code></pre></div>
<h4 id="_4">异常和错误代码</h4>
<p>在大多数情况下，JNI函数通过返回错误代码（特殊的返回值，如NULL）<em>并</em>抛出Java异常来报告错误条件。因此，程序员可以：</p>
<ul>
<li>快速检查<strong>最后一个JNI调用的返回值</strong>，以确定是否发生错误（为NULL），并</li>
<li>调用一个函数<code>ExceptionOccurred()</code>，以获取包含错误条件更详细描述的异常对象。</li>
</ul>
<p>有两种情况需要程序员先检查异常而不是先检查返回值：</p>
<ul>
<li>通过 JNI 调用 Java 方法时（call jmethod, 可能返回结果就是NULL）；</li>
<li>JNI数组访问函数不反悔错误代码，但可能抛出<code>ArrayIndexOutOfBoundsException</code>或<code>ArrayStoreException</code>。</li>
</ul>
<p>在所有其他情况下，非错误返回值保证未引发异常。</p>
<h4 id="_5">异步异常</h4>
<p>在多个线程的情况下，当前线程以外的线程可能会发布异步异常。异步异常不会立即影响当前线程中本机代码的执行，直到：</p>
<ul>
<li>本机代码调用可能引发同步异常的 JNI 函数，或者</li>
<li>机代码使用 <code>ExceptionOccurred（）</code> 显式检查同步和异步异常</li>
</ul>
<p>请注意，只有那些可能引发同步异常的 JNI 函数才会检查异步异常。</p>
<h4 id="_6">异常处理</h4>
<p>在本地代码中处理异常有两种方式：</p>
<ul>
<li>本地方法可以选择立即返回，导致<strong>异常在启动本地方法调用的Java代码中</strong>抛出。</li>
<li>本地代码可以通过<strong>调用<code>ExceptionClear()</code>清除异常</strong>，然后执行自己的异常处理代码。</li>
</ul>
<p>libhdfs 中的标准用法
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1">// 封装了JNI 函数，在调用 JNI 函数后，通过 getPendingExceptionAndClear 返回异常。</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">jthr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">invokeMethod</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">jVal</span><span class="p">,</span><span class="w"> </span><span class="n">STATIC</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">        </span><span class="n">JC_URI</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p">,</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">        </span><span class="s">&quot;(Ljava/lang/String;)Ljava/net/URI;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">jURIString</span><span class="p">);</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="c1">// 有异常，则进行打印</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jthr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">printExceptionAndFree</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jthr</span><span class="p">,</span><span class="w"> </span><span class="n">PRINT_EXC_ALL</span><span class="p">,</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">        </span><span class="s">&quot;hdfsBuilderConnect(%s)&quot;</span><span class="p">,</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">        </span><span class="n">hdfsBuilderToStr</span><span class="p">(</span><span class="n">bld</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)));</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="n">done</span><span class="p">;</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="p">}</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="nl">done</span><span class="p">:</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">    </span><span class="c1">// Release unnecessary local references</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">    </span><span class="n">destroyLocalReference</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jURI</span><span class="p">);</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">cURI</span><span class="p">);</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="n">jthrowable</span><span class="w"> </span><span class="nf">getPendingExceptionAndClear</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">    </span><span class="n">jthrowable</span><span class="w"> </span><span class="n">jthr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ExceptionOccurred</span><span class="p">(</span><span class="n">env</span><span class="p">);</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">jthr</span><span class="p">)</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ExceptionClear</span><span class="p">(</span><span class="n">env</span><span class="p">);</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">jthr</span><span class="p">;</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="p">}</span>
</code></pre></div></p>
<p>在引发异常后，本地代码必须首先清除异常，然后再进行其他JNI调用。存在待处理异常时，可以安全调用的JNI函数有：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">ExceptionOccurred</span><span class="p">()</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">ExceptionDescribe</span><span class="p">()</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">ExceptionClear</span><span class="p">()</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">ExceptionCheck</span><span class="p">()</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="n">ReleaseStringChars</span><span class="p">()</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="n">ReleaseStringUTFChars</span><span class="p">()</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="n">ReleaseStringCritical</span><span class="p">()</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="n">Release</span><span class="o">&lt;</span><span class="n">Type</span><span class="o">&gt;</span><span class="n">ArrayElements</span><span class="p">()</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="n">ReleasePrimitiveArrayCritical</span><span class="p">()</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="n">DeleteLocalRef</span><span class="p">()</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="n">DeleteGlobalRef</span><span class="p">()</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="n">DeleteWeakGlobalRef</span><span class="p">()</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="n">MonitorExit</span><span class="p">()</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="n">PushLocalFrame</span><span class="p">()</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="n">PopLocalFrame</span><span class="p">()</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="n">DetachCurrentThread</span><span class="p">()</span>
</code></pre></div>
<h2 id="jni">JNI 类型和数据结构</h2>
<h3 id="_7">基本类型</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">Java类型</th>
<th style="text-align: left;">本机类型</th>
<th style="text-align: left;">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">boolean</td>
<td style="text-align: left;">jboolean</td>
<td style="text-align: left;">无符号8位</td>
</tr>
<tr>
<td style="text-align: left;">byte</td>
<td style="text-align: left;">jbyte</td>
<td style="text-align: left;">有符号8位</td>
</tr>
<tr>
<td style="text-align: left;">char</td>
<td style="text-align: left;">jchar</td>
<td style="text-align: left;">无符号16位</td>
</tr>
<tr>
<td style="text-align: left;">short</td>
<td style="text-align: left;">jshort</td>
<td style="text-align: left;">有符号16位</td>
</tr>
<tr>
<td style="text-align: left;">int</td>
<td style="text-align: left;">jint</td>
<td style="text-align: left;">有符号32位</td>
</tr>
<tr>
<td style="text-align: left;">long</td>
<td style="text-align: left;">jlong</td>
<td style="text-align: left;">有符号64位</td>
</tr>
<tr>
<td style="text-align: left;">float</td>
<td style="text-align: left;">jfloat</td>
<td style="text-align: left;">32位</td>
</tr>
<tr>
<td style="text-align: left;">double</td>
<td style="text-align: left;">jdouble</td>
<td style="text-align: left;">64位</td>
</tr>
<tr>
<td style="text-align: left;">void</td>
<td style="text-align: left;">void</td>
<td style="text-align: left;">不适用</td>
</tr>
</tbody>
</table>
<h3 id="_8">引用类型</h3>
<p>JNI包括一些引用类型，对应不同类型的Java对象。JNI引用类型组织如下层次结构：</p>
<ul>
<li>
<p><code>jobject</code></p>
</li>
<li>
<p><code>jclass</code>（<code>java.lang.Class</code>对象）</p>
</li>
<li><code>jstring</code>（<code>java.lang.String</code>对象）</li>
<li><code>jarray（数组）</code><ul>
<li><code>jobjectArray</code>（对象数组）</li>
<li><code>jbooleanArray</code>（<code>boolean</code>数组）</li>
<li><code>jbyteArray</code>（<code>byte</code>数组）</li>
<li><code>jcharArray</code>（<code>char</code>数组）</li>
<li><code>jshortArray</code>（<code>short</code>数组）</li>
<li><code>jintArray</code>（<code>int</code>数组）</li>
<li><code>jlongArray</code>（<code>long</code>数组）</li>
<li><code>jfloatArray</code>（<code>float</code>数组）</li>
<li><code>jdoubleArray</code>（<code>double</code>数组）</li>
</ul>
</li>
<li><code>jthrowable</code>（<code>java.lang.Throwable</code>对象）</li>
</ul>
<p>在C中，所有其他JNI引用类型被定义为与jobject相同。例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">typedef</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">jclass</span><span class="p">;</span>
</code></pre></div>
<p>在C++中，JNI引入了一组虚拟类来强制子类型关系。例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">_jobject</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">_jclass</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">_jobject</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="c1">// ...</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="k">typedef</span><span class="w"> </span><span class="n">_jobject</span><span class="w"> </span><span class="o">*</span><span class="n">jobject</span><span class="p">;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="k">typedef</span><span class="w"> </span><span class="n">_jclass</span><span class="w"> </span><span class="o">*</span><span class="n">jclass</span><span class="p">;</span>
</code></pre></div>
<h3 id="id">字段和方法ID</h3>
<p>方法和字段ID是常规的<strong>C指针类型</strong>：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_jfieldID</span><span class="p">;</span><span class="w">              </span><span class="cm">/* 不透明结构 */</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_jfieldID</span><span class="w"> </span><span class="o">*</span><span class="n">jfieldID</span><span class="p">;</span><span class="w">   </span><span class="cm">/* 字段ID */</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_jmethodID</span><span class="p">;</span><span class="w">              </span><span class="cm">/* 不透明结构 */</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_jmethodID</span><span class="w"> </span><span class="o">*</span><span class="n">jmethodID</span><span class="p">;</span><span class="w"> </span><span class="cm">/* 方法ID */</span>
</code></pre></div>
<h3 id="_9">值类型</h3>
<p><code>jvalue</code>联合类型用作参数数组中的元素类型。它声明如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="nc">jvalue</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="n">jboolean</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="n">jbyte</span><span class="w">    </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="n">jchar</span><span class="w">    </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="n">jshort</span><span class="w">   </span><span class="n">s</span><span class="p">;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span><span class="n">jint</span><span class="w">     </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="n">jlong</span><span class="w">    </span><span class="n">j</span><span class="p">;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="n">jfloat</span><span class="w">   </span><span class="n">f</span><span class="p">;</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="n">jdouble</span><span class="w">  </span><span class="n">d</span><span class="p">;</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">    </span><span class="n">jobject</span><span class="w">  </span><span class="n">l</span><span class="p">;</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="p">}</span><span class="w"> </span><span class="n">jvalue</span><span class="p">;</span>
</code></pre></div>
<h3 id="_10">类型签名</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">类型签名</th>
<th style="text-align: left;">Java类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>Z</code></td>
<td style="text-align: left;">boolean</td>
</tr>
<tr>
<td style="text-align: left;"><code>B</code></td>
<td style="text-align: left;">byte</td>
</tr>
<tr>
<td style="text-align: left;"><code>C</code></td>
<td style="text-align: left;">char</td>
</tr>
<tr>
<td style="text-align: left;"><code>S</code></td>
<td style="text-align: left;">short</td>
</tr>
<tr>
<td style="text-align: left;"><code>I</code></td>
<td style="text-align: left;">int</td>
</tr>
<tr>
<td style="text-align: left;"><code>J</code></td>
<td style="text-align: left;">long</td>
</tr>
<tr>
<td style="text-align: left;"><code>F</code></td>
<td style="text-align: left;">float</td>
</tr>
<tr>
<td style="text-align: left;"><code>D</code></td>
<td style="text-align: left;">double</td>
</tr>
<tr>
<td style="text-align: left;"><code>L</code> 完全限定类 <code>;</code></td>
<td style="text-align: left;">完全限定类</td>
</tr>
<tr>
<td style="text-align: left;"><code>[</code> 类型</td>
<td style="text-align: left;">类型[]</td>
</tr>
<tr>
<td style="text-align: left;"><code>(</code> 参数类型 <code>)</code> 返回类型</td>
<td style="text-align: left;">方法类型</td>
</tr>
</tbody>
</table>
<p>例如，Java方法：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kt">long</span><span class="w"> </span><span class="nf">f</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">arr</span><span class="p">);</span>
</code></pre></div>
<p>具有以下类型签名：<code>(ILjava/lang/String;[I)J</code></p>
<h3 id="utf-8">修改后的UTF-8字符串</h3>
<p>JNI使用修改后的<strong>UTF-8字符串</strong>来表示各种字符串类型。修改后的UTF-8字符串与Java虚拟机使用的相同。</p>
<ul>
<li>多字节字符的字节以大端（高字节在前）顺序存储在<code>class</code>文件中。</li>
</ul>
<p>与标准UTF-8格式之间存在两个差异:</p>
<ul>
<li>空字符<code>(char)0</code>使用两字节格式（0xC0 0x80）而不是一个字节格式（0x00）进行编码，确保了编码后的字符串中不会嵌入null字符。</li>
<li>仅使用标准<strong>UTF-8的一个字节、两字节和三字节</strong>格式</li>
<li>标准UTF-8<strong>的四字节格式被使用自己的两次三字节</strong>格式代替</li>
</ul>
<h2 id="jni_1">JNI 函数</h2>
<h3 id="_11">常量</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="cp">#define JNI_FALSE 0</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="cp">#define JNI_TRUE 1</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="c1">// 用于JNI函数的一般返回值常量。</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="cp">#define JNI_OK           0                 </span><span class="cm">/* 成功 */</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="cp">#define JNI_ERR          (-1)              </span><span class="cm">/* 未知错误 */</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="cp">#define JNI_EDETACHED    (-2)              </span><span class="cm">/* 线程与VM分离 */</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="cp">#define JNI_EVERSION     (-3)              </span><span class="cm">/* JNI版本错误 */</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="cp">#define JNI_ENOMEM       (-4)              </span><span class="cm">/* 内存不足 */</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="cp">#define JNI_EEXIST       (-5)              </span><span class="cm">/* VM已创建 */</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="cp">#define JNI_EINVAL       (-6)              </span><span class="cm">/* 无效参数 */</span>
</code></pre></div>
<h3 id="_12">版本信息</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1">// JNI_VERSION_1_8, JDK 17 对应 JNI_VERSION_10</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">jint</span><span class="w"> </span><span class="nf">GetVersion</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">);</span>
</code></pre></div>
<h3 id="_13">类操作</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1">// 从原始类数据缓冲区 buf 加载类，返回后，buf 可以被丢弃。</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="c1">// name: 要定义的类或接口的名称。字符串以修改后的UTF-8编码。此值可以为NULL。</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="c1">// loader: 分配给定义类的类加载器。此值可以为NULL，表示“空类加载器”（或“引导类加载器”）。</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="n">jclass</span><span class="w"> </span><span class="nf">DefineClass</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">loader</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">jbyte</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">bufLen</span><span class="p">);</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="c1">// name: 完全限定的类名（即包名，由“/”分隔，后跟类名）。如果名称以“[”（数组签名字符）开头，则返回一个数组类。字符串以修改后的UTF-8编码</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="c1">// 不存在当前本地方法或其关联的类加载器时，使用ClassLoader.getSystemClassLoader，读取java.class.path中的类；</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="c1">// 通过本地方法时，JNI_OnLoad和JNI_OnLoad_L，使用加载本地库的类的类加载器；JNI_OnUnload(_L)使用SystemClassLoader（因为加载时使用的类加载器可能不存在）</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="n">jclass</span><span class="w"> </span><span class="nf">FindClass</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="c1">// 如果clazz表示除Object类之外的任何类，则此函数返回表示clazz指定的类的超类的对象。</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="c1">// 如果clazz指定Object类，或者clazz表示一个接口，则此函数返回NULL。</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="n">jclass</span><span class="w"> </span><span class="nf">GetSuperclass</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">);</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="c1">// 确定clazz1的对象是否可以安全地转换为clazz2。</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="c1">// 如果以下任一情况为真，则返回JNI_TRUE：</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="c1">//    第一个和第二个类参数引用相同的Java类。</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="c1">//    第一个类是第二个类的子类。</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="c1">//    第一个类将第二个类作为其接口之一。</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="n">jboolean</span><span class="w"> </span><span class="nf">IsAssignableFrom</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz1</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz2</span><span class="p">);</span>
</code></pre></div>
<h3 id="_14">模块操作</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1">// 返回类所属模块的java.lang.Module对象。如果类不在命名模块中，则返回类加载器的未命名模块。</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="c1">// 如果类表示数组类型，则此函数返回元素类型的Module对象。如果类表示原始类型或void，则返回java.base模块的Module对象。</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">jobject</span><span class="w"> </span><span class="nf">GetModule</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">);</span>
</code></pre></div>
<h3 id="_15">线程操作</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">// 测试对象是否为虚拟线程。</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">jboolean</span><span class="w"> </span><span class="nf">IsVirtualThread</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">);</span>
</code></pre></div>
<h3 id="_16">异常</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1">// 导致抛出java.lang.Throwable对象。</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">jint</span><span class="w"> </span><span class="nf">Throw</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jthrowable</span><span class="w"> </span><span class="n">obj</span><span class="p">);</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="c1">// 使用由message指定的消息从指定类构造异常对象，并导致抛出该异常。</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="c1">// clazz: java.lang.Throwable的子类，不得为NULL。</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="n">jint</span><span class="w"> </span><span class="nf">ThrowNew</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">message</span><span class="p">);</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="c1">// 确定是否正在抛出异常。异常保持被抛出状态，直到本地代码调用ExceptionClear()，或Java代码处理异常。</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="c1">// 返回当前正在被抛出的异常对象，如果当前没有异常被抛出，则返回NULL。</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="n">jthrowable</span><span class="w"> </span><span class="nf">ExceptionOccurred</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">);</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="c1">// 将异常和堆栈的回溯打印到系统错误报告通道，如stderr。调用此函数的副作用是清除挂起的异常。这是为调试提供的便利程序。</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="kt">void</span><span class="w"> </span><span class="nf">ExceptionDescribe</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">);</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="c1">// 清除当前正在被抛出的任何异常。如果当前没有异常被抛出，则此例程不起作用。</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="kt">void</span><span class="w"> </span><span class="nf">ExceptionClear</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">);</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="c1">// 引发致命错误，并且不希望虚拟机恢复。此函数不返回。</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="kt">void</span><span class="w"> </span><span class="nf">FatalError</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">);</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="c1">// 用于检查是否存在未决异常，而不创建异常对象的本地引用。</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="n">jboolean</span><span class="w"> </span><span class="nf">ExceptionCheck</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">);</span>
</code></pre></div>
<h3 id="_17">全局和局部引用</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1">// 创建一个新的全局引用，指向obj参数引用的对象。 obj参数可以是全局引用或局部引用。 必须通过调用DeleteGlobalRef()显式处理全局引用。</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="c1">// 如果可能返回NULL的情况包括：</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="c1">//  obj引用为null</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="c1">//  系统内存不足</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="c1">//  obj是弱全局引用并且已被垃圾回收</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="n">jobject</span><span class="w"> </span><span class="nf">NewGlobalRef</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">);</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="c1">// 删除由globalRef指向的全局引用。</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="kt">void</span><span class="w"> </span><span class="nf">DeleteGlobalRef</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">globalRef</span><span class="p">);</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="c1">// 删除由localRef指向的局部引用。</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="kt">void</span><span class="w"> </span><span class="nf">DeleteLocalRef</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">localRef</span><span class="p">);</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="c1">// 确保当前线程中至少可以创建给定数量的局部引用。 成功返回0；否则返回负数并抛出OutOfMemoryError。</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="n">jint</span><span class="w"> </span><span class="nf">EnsureLocalCapacity</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jint</span><span class="w"> </span><span class="n">capacity</span><span class="p">);</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="c1">// 创建一个新的局部引用帧，在其中至少可以创建给定数量的局部引用。 成功返回0，失败时返回负数并挂起OutOfMemoryError。</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="n">jint</span><span class="w"> </span><span class="nf">PushLocalFrame</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jint</span><span class="w"> </span><span class="n">capacity</span><span class="p">);</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="c1">// 弹出当前局部引用帧，释放所有局部引用，并为给定的result对象返回上一个局部引用帧中的局部引用。</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="c1">// 如果不需要返回到先前帧的引用，则将result传递为NULL。</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="n">jobject</span><span class="w"> </span><span class="nf">PopLocalFrame</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
</code></pre></div>
<h3 id="_18">弱全局引用</h3>
<p>弱全局引用允许底层Java对象被垃圾回收。 弱全局引用可以在任何需要全局或局部引用的情况下使用。</p>
<p><code>IsSameObject</code>可用于比较弱全局引用与非<code>NULL</code>局部或全局引用。 如果对象相同，则只要另一个引用未被删除，弱全局引用就不会变得等效于<code>NULL</code>。</p>
<ul>
<li>不应依赖<code>IsSameObject(weakObj, NULL)</code>来确定将来的JNI函数调用中是否可以使用弱全局引用（作为非<code>NULL</code>引用），因为介入的垃圾回收可能会更改弱全局引用。</li>
<li>使用JNI函数<code>NewLocalRef</code>或<code>NewGlobalRef</code>获取对底层对象的（强）局部或全局引用。 如果对象已被释放，这些函数将返回<code>NULL</code>。 否则，新引用将防止底层对象被释放。</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1">// 创建一个新的弱全局引用。  可以使用IsSameObject来测试引用的对象是否已被释放。 如果obj引用为null，或者虚拟机内存不足，则返回NULL。 如果虚拟机内存不足，同时将抛出OutOfMemoryError。</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">jweak</span><span class="w"> </span><span class="nf">NewWeakGlobalRef</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">);</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="c1">// 删除给定弱全局引用所需的VM资源。</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">DeleteWeakGlobalRef</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jweak</span><span class="w"> </span><span class="n">obj</span><span class="p">);</span>
</code></pre></div>
<h3 id="_19">对象操作</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1">// 分配一个新的Java对象而不调用对象的任何构造函数。返回对象的引用。</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="c1">// clazz参数不得引用数组类。</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">jobject</span><span class="w"> </span><span class="nf">AllocObject</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">);</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="c1">// 构造一个新的Java对象。方法ID指示要调用的构造方法。此ID必须通过使用GetMethodID()并将&lt;init&gt;作为方法名和void (V)作为返回类型来获取。</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="n">jobject</span><span class="w"> </span><span class="nf">NewObject</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">methodID</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="n">jobject</span><span class="w"> </span><span class="nf">NewObjectA</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">methodID</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">jvalue</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">);</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="n">jobject</span><span class="w"> </span><span class="nf">NewObjectV</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">methodID</span><span class="p">,</span><span class="w"> </span><span class="kt">va_list</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="c1">// 返回对象的类。</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="n">jclass</span><span class="w"> </span><span class="nf">GetObjectClass</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">);</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="c1">// 返回由obj参数引用的对象的类型。参数obj可以是本地、全局或弱全局引用，也可以是NULL。</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="c1">// JNIInvalidRefType    = 0</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="c1">// JNILocalRefType      = 1</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="c1">// JNIGlobalRefType     = 2</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="c1">// JNIWeakGlobalRefType = 3</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="n">jobjectRefType</span><span class="w"> </span><span class="nf">GetObjectRefType</span><span class="p">(</span><span class="n">JNIEnv</span><span class="o">*</span><span class="w"> </span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">);</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="c1">// 测试对象是否是类的实例。</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="n">jboolean</span><span class="w"> </span><span class="nf">IsInstanceOf</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">);</span>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="c1">// 测试两个引用是否指向相同的Java对象</span>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="n">jboolean</span><span class="w"> </span><span class="nf">IsSameObject</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">ref1</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">ref2</span><span class="p">);</span>
</code></pre></div>
<h3 id="_20">访问对象的字段</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1">// 返回类的实例（非静态）字段的字段ID。字段由其名称和签名指定。 导致一个未初始化的类被初始化。</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="c1">// GetFieldID()不能用于获取数组的长度字段。请改用GetArrayLength()。</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">jfieldID</span><span class="w"> </span><span class="nf">GetFieldID</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">sig</span><span class="p">);</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="c1">// 返回对象的实例（非静态）字段的值</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="c1">// 如 jint GetIntField()</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Get</span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">Field</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">jfieldID</span><span class="w"> </span><span class="n">fieldID</span><span class="p">);</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="c1">// 设置对象的实例（非静态）字段的值</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="c1">// 如 SetIntField(JNIEnv *env, jobject obj, jfieldID fieldID, jint value)</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="kt">void</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">Field</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">jfieldID</span><span class="w"> </span><span class="n">fieldID</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
</code></pre></div>
<h3 id="_21">调用实例方法</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">// 返回类或接口的实例（非静态）方法的方法ID，包括父类/接口中的方法。导致一个未初始化的类被初始化。</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="c1">// 要获取构造函数的方法ID，请将&lt;init&gt;作为方法名称并将void（V）作为返回类型。</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">jmethodID</span><span class="w"> </span><span class="nf">GetMethodID</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">sig</span><span class="p">);</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="c1">// 调用Java实例方法。它们在向调用的方法传递参数的机制上有所不同。</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Call</span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">Method</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">methodID</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Call</span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">MethodA</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">methodID</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">jvalue</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">);</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Call</span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">MethodV</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">methodID</span><span class="p">,</span><span class="w"> </span><span class="kt">va_list</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="c1">// 多个 clazz 参数，调用指定类（自身类或者其超类）的方法，用于调用被子类覆盖的父类的方法。</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CallNonvirtual</span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">Method</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">methodID</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CallNonvirtual</span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">MethodA</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">methodID</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">jvalue</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">);</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CallNonvirtual</span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">MethodV</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">methodID</span><span class="p">,</span><span class="w"> </span><span class="kt">va_list</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
</code></pre></div>
<h3 id="_22">访问静态字段</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1">// 返回类的静态字段的字段ID。</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">jfieldID</span><span class="w"> </span><span class="nf">GetStaticFieldID</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">sig</span><span class="p">);</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="c1">// 返回对象的静态字段的值</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetStatic</span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">Field</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="n">jfieldID</span><span class="w"> </span><span class="n">fieldID</span><span class="p">);</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="c1">// 设置对象的静态字段的值</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="kt">void</span><span class="w"> </span><span class="n">SetStatic</span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">Field</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="n">jfieldID</span><span class="w"> </span><span class="n">fieldID</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
</code></pre></div>
<h3 id="_23">调用静态方法</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1">// 获取静态方法</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">jmethodID</span><span class="w"> </span><span class="nf">GetStaticMethodID</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">sig</span><span class="p">);</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="c1">// 调用静态方法</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CallStatic</span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">Method</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">methodID</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CallStatic</span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">MethodA</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">methodID</span><span class="p">,</span><span class="w"> </span><span class="n">jvalue</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">);</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CallStatic</span><span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">MethodV</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">methodID</span><span class="p">,</span><span class="w"> </span><span class="kt">va_list</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
</code></pre></div>
<h3 id="_24">字符串操作</h3>
<p>这里的 unicode 表示 utf 16编码。</p>
<ul>
<li><a href="https://en.cppreference.com/w/cpp/language/charset#Code_unit_and_literal_encoding">C/C++ 中的字符串常量的编码</a>，默认是跟文件的存储编码相关的。</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1">// 从Unicode字符数组构造一个新的java.lang.String对象。</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">jstring</span><span class="w"> </span><span class="nf">NewString</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">jchar</span><span class="w"> </span><span class="o">*</span><span class="n">unicodeChars</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">len</span><span class="p">);</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="c1">// 返回Java字符串的长度（Unicode字符数）。</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="n">jsize</span><span class="w"> </span><span class="nf">GetStringLength</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jstring</span><span class="w"> </span><span class="n">string</span><span class="p">);</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="c1">// 返回字符串的Unicode字符数组的指针。此指针有效直到调用ReleaseStringChars()。</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="c1">// *isCopy 设置为 JNI_TRUE（如果创建副本）; 或者如果未创建副本，则设置为 JNI_FALSE。</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="k">const</span><span class="w"> </span><span class="n">jchar</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">GetStringChars</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jstring</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">jboolean</span><span class="w"> </span><span class="o">*</span><span class="n">isCopy</span><span class="p">);</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="c1">// 通知VM本地代码不再需要访问chars。</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="kt">void</span><span class="w"> </span><span class="nf">ReleaseStringChars</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jstring</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">jchar</span><span class="w"> </span><span class="o">*</span><span class="n">chars</span><span class="p">);</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="c1">// 从修改后的UTF-8编码字符数组构造一个新的java.lang.String对象。</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="n">jstring</span><span class="w"> </span><span class="nf">NewStringUTF</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">bytes</span><span class="p">);</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="c1">// 返回字符串的修改后的UTF-8表示的字节长度。</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="n">jsize</span><span class="w"> </span><span class="nf">GetStringUTFLength</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jstring</span><span class="w"> </span><span class="n">string</span><span class="p">);</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="c1">// 返回一个指向以修改后的UTF-8编码表示的字符串的字节数组的指针。该数组有效直到被ReleaseStringUTFChars()释放。</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="c1">// *isCopy 设置为 JNI_TRUE（如果创建副本）; 或者如果未创建副本，则设置为 JNI_FALSE。</span>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">GetStringUTFChars</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jstring</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">jboolean</span><span class="w"> </span><span class="o">*</span><span class="n">isCopy</span><span class="p">);</span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="c1">// 通知虚拟机本地代码不再需要访问utf。</span>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a><span class="kt">void</span><span class="w"> </span><span class="nf">ReleaseStringUTFChars</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jstring</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">utf</span><span class="p">);</span>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a><span class="c1">// 将从偏移量start开始的len个Unicode字符复制到给定的缓冲区buf中。</span>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a><span class="kt">void</span><span class="w"> </span><span class="nf">GetStringRegion</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jstring</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">jchar</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a><span class="c1">// 将从偏移量start开始的len个Unicode字符转换为修改后的UTF-8编码，并将结果放入给定的缓冲区buf中。</span>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a><span class="c1">// 生成的修改后的UTF-8编码字符数可能大于给定的len参数。可以使用GetStringUTFLength()来确定所需字符缓冲区的最大大小。</span>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a><span class="c1">// 由于此规范不要求生成的字符串副本以NULL结尾，建议在使用此函数之前清除给定的字符缓冲区（例如&quot;memset()&quot;），以便安全地执行strlen()。</span>
<a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a><span class="kt">void</span><span class="w"> </span><span class="nf">GetStringUTFRegion</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jstring</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a>
<a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a><span class="c1">// 语义类似于现有的Get/ReleaseStringChars函数。如果可能，VM 将返回指向字符串元素的指针;否则，将创建一个副本。</span>
<a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a><span class="c1">// 但是这些功能的使用方式存在很大限制。在 Get/ReleaseStringCritical 调用包含的代码段中，本机代码不得发出任意 JNI 调用，也不得导致当前线程阻塞。</span>
<a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a><span class="k">const</span><span class="w"> </span><span class="n">jchar</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">GetStringCritical</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jstring</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">jboolean</span><span class="w"> </span><span class="o">*</span><span class="n">isCopy</span><span class="p">);</span>
<a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a><span class="kt">void</span><span class="w"> </span><span class="nf">ReleaseStringCritical</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jstring</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">jchar</span><span class="w"> </span><span class="o">*</span><span class="n">carray</span><span class="p">);</span><span class="w">    </span>
</code></pre></div>
<h3 id="_25">数组操作</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1">// 返回数组中的元素数量。</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">jsize</span><span class="w"> </span><span class="nf">GetArrayLength</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jarray</span><span class="w"> </span><span class="n">array</span><span class="p">);</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="c1">// 构造一个持有elementClass类中对象的新数组。所有元素最初设置为initialElement。</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="n">jobjectArray</span><span class="w"> </span><span class="nf">NewObjectArray</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">elementClass</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">initialElement</span><span class="p">);</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="c1">// 返回Object数组的一个元素。用于对象数组，或者多维数组。</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="n">jobject</span><span class="w"> </span><span class="nf">GetObjectArrayElement</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobjectArray</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">index</span><span class="p">);</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="c1">// 设置Object数组的一个元素。</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="kt">void</span><span class="w"> </span><span class="nf">SetObjectArrayElement</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobjectArray</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="c1">// 创建基本类型是数组，如  jintArray NewIntArray()</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="o">&lt;</span><span class="n">ArrayType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">New</span><span class="o">&lt;</span><span class="n">PrimitiveType</span><span class="o">&gt;</span><span class="n">Array</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="c1">// 返回原始数组的内容。结果在对应的Release&lt;PrimitiveType&gt;ArrayElements()函数被调用之前有效。</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="c1">// 由于返回的数组可能是Java数组的副本，对返回的数组进行的更改不一定会反映在原始数组中，直到调用Release&lt;PrimitiveType&gt;ArrayElements()为止。</span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="c1">// 如果JVM的GC支持pin操作，NULL、JNIFALSE 才有用，表示直接返回指向原始数组的指针，x86处理器的模拟器是不支持pin</span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="o">*</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">PrimitiveType</span><span class="o">&gt;</span><span class="n">ArrayElements</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">ArrayType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">jboolean</span><span class="w"> </span><span class="o">*</span><span class="n">isCopy</span><span class="p">);</span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="c1">// 通知虚拟机本机代码不再需要访问elems.</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="c1">// mode参数(默认用0即可）提供有关如何释放数组缓冲区的信息。如果elems不是数组中元素的副本，则mode不起作用。否则，mode具有以下影响，如下表所示:</span>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="c1">// 模式          操作</span>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="c1">// 0            复制回内容并释放elems缓冲区</span>
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="c1">// JNI_COMMIT   复制回内容但不释放elems缓冲区</span>
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="c1">// JNI_ABORT    释放缓冲区而不复制回可能的更改</span>
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="kt">void</span><span class="w"> </span><span class="n">Release</span><span class="o">&lt;</span><span class="n">PrimitiveType</span><span class="o">&gt;</span><span class="n">ArrayElements</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">ArrayType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">NativeType</span><span class="w"> </span><span class="o">*</span><span class="n">elems</span><span class="p">,</span><span class="w"> </span><span class="n">jint</span><span class="w"> </span><span class="n">mode</span><span class="p">);</span>
<a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>
<a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a><span class="c1">// 将原始数组的区域复制到缓冲区中。</span>
<a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a><span class="kt">void</span><span class="w"> </span><span class="n">Get</span><span class="o">&lt;</span><span class="n">PrimitiveType</span><span class="o">&gt;</span><span class="n">ArrayRegion</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">ArrayType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">NativeType</span><span class="o">&gt;</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a><span class="c1">// 从缓冲区中将原始数组的区域复制回去。</span>
<a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="kt">void</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">PrimitiveType</span><span class="o">&gt;</span><span class="n">ArrayRegion</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">ArrayType</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">NativeType</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">);</span>
</code></pre></div>
<h3 id="_26">注册本地方法</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1">// 使用clazz参数指定的类注册本机方法，即将 Java native 方法映射为 C 中的方法。</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="c1">// JNINativeMethod结构的name和signature字段是指向修改后的UTF-8字符串的指针。 nMethods参数指定数组中的本机方法数量。 </span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="c1">// typedef struct {</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="c1">//    char *name;</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="c1">//    char *signature;</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="c1">//    void *fnPtr;</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="c1">// } JNINativeMethod;</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="c1">// 函数指针名义上必须具有以下签名：</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="c1">// ReturnType (*fnPtr)(JNIEnv *env, jobject objectOrClass, ...);</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="n">ReturnType</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fnPtr</span><span class="p">)(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">objectOrClass</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="n">jint</span><span class="w"> </span><span class="nf">RegisterNatives</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">JNINativeMethod</span><span class="w"> </span><span class="o">*</span><span class="n">methods</span><span class="p">,</span><span class="w"> </span><span class="n">jint</span><span class="w"> </span><span class="n">nMethods</span><span class="p">);</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="c1">// 取消注册类的本机方法。 类返回到链接或注册其本机方法函数之前的状态。</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="n">jint</span><span class="w"> </span><span class="nf">UnregisterNatives</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">clazz</span><span class="p">);</span>
</code></pre></div>
<h3 id="_27">监视器操作</h3>
<p>每个Java对象都有一个与之关联的监视器。</p>
<ul>
<li>如果当前线程已经拥有与<code>obj</code>关联的监视器，则会增加监视器中的计数器，指示该线程进入监视器的次数</li>
<li>如果与<code>obj</code>关联的监视器没有被任何线程拥有，则当前线程将成为监视器的所有者，将该监视器的进入计数设置为1。</li>
<li>如果另一个线程已经拥有与<code>obj</code>关联的监视器，则当前线程将等待直到监视器被释放，然后再次尝试获取所有权。</li>
</ul>
<p>通过<code>MonitorEnter</code> JNI函数调用进入的监视器不能使用<code>monitorexit</code> Java虚拟机指令或同步方法返回退出。<code>MonitorEnter</code> JNI函数调用和<code>monitorenter</code> Java虚拟机指令可能会竞争进入与同一对象关联的监视器。</p>
<p>为避免死锁，通过<code>MonitorEnter</code> JNI函数调用进入的监视器必须使用<code>MonitorExit</code> JNI调用退出，除非使用<code>DetachCurrentThread</code>调用隐式释放JNI监视器。</p>
<p>本机代码不能使用<code>MonitorExit</code>退出通过同步方法或<code>monitorenter</code> Java虚拟机指令进入的监视器。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1">// 进入与obj引用的底层Java对象关联的监视器。</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">jint</span><span class="w"> </span><span class="nf">MonitorEnter</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">);</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="c1">// 当前线程必须是与obj引用的底层Java对象关联的监视器的所有者。线程减少指示它进入此监视器的次数。如果计数器的值变为零，则当前线程释放监视器。</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="n">jint</span><span class="w"> </span><span class="nf">MonitorExit</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">obj</span><span class="p">);</span>
</code></pre></div>
<h3 id="nio">NIO 支持</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1">// 分配并返回一个直接引用内存地址为address、长度为capacity字节的java.nio.ByteBuffer。返回的缓冲区的字节顺序始终为大端序。</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="c1">// capacity 不能为负数或大于Integer.MAX_VALUE</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">jobject</span><span class="w"> </span><span class="nf">NewDirectByteBuffer</span><span class="p">(</span><span class="n">JNIEnv</span><span class="o">*</span><span class="w"> </span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">jlong</span><span class="w"> </span><span class="n">capacity</span><span class="p">);</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="c1">// 获取并返回给定直接java.nio.Buffer引用的内存区域的起始地址。允许本机代码访问与Java代码通过缓冲区对象访问的相同内存区域。</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">GetDirectBufferAddress</span><span class="p">(</span><span class="n">JNIEnv</span><span class="o">*</span><span class="w"> </span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">buf</span><span class="p">);</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="c1">// 获取并返回给定直接java.nio.Buffer引用的内存区域的容量。容量是内存区域包含的元素数量。</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="n">jlong</span><span class="w"> </span><span class="nf">GetDirectBufferCapacity</span><span class="p">(</span><span class="n">JNIEnv</span><span class="o">*</span><span class="w"> </span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">buf</span><span class="p">);</span>
</code></pre></div>
<h3 id="_28">反射支持</h3>
<p>JNI提供了一组在JNI中使用的字段和方法ID与Java核心<strong>反射API中使用的字段和方法对象</strong>之间进行转换的函数。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1">// 将java.lang.reflect.Method或java.lang.reflect.Constructor对象转换为方法ID。</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="c1">// method：一个java.lang.reflect.Method或java.lang.reflect.Constructor对象，不得为NULL。</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="n">jmethodID</span><span class="w"> </span><span class="nf">FromReflectedMethod</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">method</span><span class="p">);</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="c1">// 将java.lang.reflect.Field转换为字段ID。</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="n">jfieldID</span><span class="w"> </span><span class="nf">FromReflectedField</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">field</span><span class="p">);</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="c1">// 将从cls派生的方法ID转换为java.lang.reflect.Method或java.lang.reflect.Constructor对象。</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="c1">// 设置为JNI_TRUE，如果方法ID引用静态字段，否则设置为JNI_FALSE</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="n">jobject</span><span class="w"> </span><span class="nf">ToReflectedMethod</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">methodID</span><span class="p">,</span><span class="w"> </span><span class="n">jboolean</span><span class="w"> </span><span class="n">isStatic</span><span class="p">);</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="c1">// 将从cls派生的字段ID转换为一个java.lang.reflect.Field对象。</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="n">jobject</span><span class="w"> </span><span class="nf">ToReflectedField</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jclass</span><span class="w"> </span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="n">jfieldID</span><span class="w"> </span><span class="n">fieldID</span><span class="p">,</span><span class="w"> </span><span class="n">jboolean</span><span class="w"> </span><span class="n">isStatic</span><span class="p">);</span>
</code></pre></div>
<h3 id="vm">VM 接口</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1">// 返回与当前线程关联的Java VM接口（在调用API中使用）。结果放置在第二个参数vm指向的位置。</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="c1">// 成功返回&quot;0&quot;；失败返回负值。</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="n">jint</span><span class="w"> </span><span class="nf">GetJavaVM</span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">JavaVM</span><span class="w"> </span><span class="o">**</span><span class="n">vm</span><span class="p">);</span>
</code></pre></div>
<h2 id="api">调用 API</h2>
<p>调用API允许软件供应商将Java虚拟机加载到任意本机应用程序中。</p>
<h3 id="_29">概述</h3>
<p>示例C++代码创建了一个Java虚拟机，并调用了一个名为<code>Main.test</code>的静态方法</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;jni.h&gt;</span><span class="c1">       /* 定义所有内容的位置 */</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="p">...</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="n">JavaVM</span><span class="w"> </span><span class="o">*</span><span class="n">jvm</span><span class="p">;</span><span class="w">       </span><span class="cm">/* 表示Java虚拟机 */</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">;</span><span class="w">       </span><span class="cm">/* 指向本机方法接口的指针 */</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="n">JavaVMInitArgs</span><span class="w"> </span><span class="n">vm_args</span><span class="p">;</span><span class="w"> </span><span class="cm">/* JDK/JRE 19 VM初始化参数 */</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="n">JavaVMOption</span><span class="o">*</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JavaVMOption</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">optionString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;-Djava.class.path=/usr/lib/java&quot;</span><span class="p">;</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="n">vm_args</span><span class="p">.</span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JNI_VERSION_19</span><span class="p">;</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="n">vm_args</span><span class="p">.</span><span class="n">nOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="n">vm_args</span><span class="p">.</span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">options</span><span class="p">;</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="n">vm_args</span><span class="p">.</span><span class="n">ignoreUnrecognized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="cm">/* 加载和初始化Java虚拟机，返回一个JNI接口指针</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="cm"> * 在env中 */</span>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="n">JNI_CreateJavaVM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">jvm</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vm_args</span><span class="p">);</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="k">delete</span><span class="w"> </span><span class="n">options</span><span class="p">;</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="cm">/* 使用JNI调用Main.test方法 */</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="n">jclass</span><span class="w"> </span><span class="n">cls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">-&gt;</span><span class="n">FindClass</span><span class="p">(</span><span class="s">&quot;Main&quot;</span><span class="p">);</span>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="n">jmethodID</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">-&gt;</span><span class="n">GetStaticMethodID</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;(I)V&quot;</span><span class="p">);</span>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a><span class="n">env</span><span class="o">-&gt;</span><span class="n">CallStaticVoidMethod</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="cm">/* 完成。 */</span>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a><span class="n">jvm</span><span class="o">-&gt;</span><span class="n">DestroyJavaVM</span><span class="p">();</span>
</code></pre></div>
<h4 id="_30">创建虚拟机</h4>
<p><code>JNI_CreateJavaVM()</code>函数加载并初始化Java虚拟机，并返回一个JNI接口指针。</p>
<ul>
<li>调用<code>JNI_CreateJavaVM()</code>的线程被视为<em>主线程</em>，并附加到Java虚拟机。</li>
</ul>
<h4 id="_31">附加到虚拟机</h4>
<p>JNI接口指针（<code>JNIEnv</code>）仅在当前线程中有效。如果另一个线程需要访问Java虚拟机，先调用<code>AttachCurrentThread()</code>将自己附加到虚拟机并获取JNI接口指针。</p>
<ul>
<li>附加的线程应该有足够的堆栈空间来执行合理数量的工作。用pthread时，堆栈大小可以在<code>pthread_create</code>的<code>pthread_attr_t</code>参数中指定。</li>
</ul>
<h4 id="_32">从虚拟机分离</h4>
<p>附加到虚拟机的本机线程在终止之前必须调用<code>DetachCurrentThread()</code>将自己分离。如果调用堆栈上有Java方法，则线程无法分离自己。</p>
<h4 id="_33">终止虚拟机</h4>
<p><code>DestroyJavaVM()</code>函数终止Java虚拟机。</p>
<ul>
<li>待直到<strong>没有非守护线程</strong>在执行，然后才实际终止虚拟机；非守护线程包括<strong>Java线程和附加的本机线程</strong>。</li>
</ul>
<h3 id="_34">库和版本管理</h3>
<blockquote>
<p><strong>相同的 JNI 本机库不能加载到多个类加载器中。</strong></p>
</blockquote>
<p>当使用<code>System.loadLibrary</code>将本机库加载到两个类加载器中时，会抛出<code>UnsatisfiedLinkError</code>。这种方法的好处包括：</p>
<ul>
<li>基于类加载器的名称空间分离在本机库中得以保留。本机库不能轻松混合来自不同类加载器的类。</li>
<li>此外，当相应的类加载器被垃圾回收时，本机库可以被卸载。</li>
</ul>
<h4 id="_35">静态链接库支持</h4>
<h4 id="_36">库生命周期函数挂钩</h4>
<p>为了便于版本控制和资源管理，JNI库可以定义<strong><em>加载</em></strong>和<strong><em>卸载</em></strong>函数挂钩。这些函数的命名取决于库是动态链接还是静态链接。</p>
<h4 id="jni_onload">JNI_OnLoad</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1">// reserved：未使用的指针。返回所需的JNI_VERSION常量</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">jint</span><span class="w"> </span><span class="nf">JNI_OnLoad</span><span class="p">(</span><span class="n">JavaVM</span><span class="w"> </span><span class="o">*</span><span class="n">vm</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">reserved</span><span class="p">);</span>
</code></pre></div>
<p><code>JNI_OnLoad</code>必须返回至少定义JNI API 版本的常量：</p>
<ul>
<li>如果本机库不导出<code>JNI_OnLoad</code>函数，则VM假定该库仅需要JNI版本<code>JNI_VERSION_1_1</code>。</li>
</ul>
<h4 id="jni_onunload">JNI_OnUnload</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1">//当包含本机库的类加载器被垃圾回收时，VM会调用JNI_OnUnload。</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">JNI_OnUnload</span><span class="p">(</span><span class="n">JavaVM</span><span class="w"> </span><span class="o">*</span><span class="n">vm</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">reserved</span><span class="p">);</span>
</code></pre></div>
<p>此函数可用于执行清理操作。由于此函数在未知上下文中调用（例如从终结器调用），程序员在使用Java VM服务时应保守，并避免任意的Java回调。</p>
<h4 id="jni_onload_l">JNI_OnLoad_L</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">jint</span><span class="w"> </span><span class="n">JNI_Onload_</span><span class="o">&lt;</span><span class="n">L</span><span class="o">&gt;</span><span class="p">(</span><span class="n">JavaVM</span><span class="w"> </span><span class="o">*</span><span class="n">vm</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">reserved</span><span class="p">);</span>
</code></pre></div>
<p>如果一个名为'L'的库是静态链接的，那么在第一次调用<code>System.loadLibrary("L")</code>或等效的API时，将调用一个具有与<code>JNI_OnLoad</code>函数指定的相同参数和期望返回值的<code>JNI_OnLoad_L</code>函数。</p>
<ul>
<li>返回本地库所需的JNI版本，此版本必须是<code>JNI_VERSION_1_8</code>或更高版本。</li>
</ul>
<h4 id="jni_onunload_l">JNI_OnUnload_L</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kt">void</span><span class="w"> </span><span class="n">JNI_OnUnload_</span><span class="o">&lt;</span><span class="n">L</span><span class="o">&gt;</span><span class="p">(</span><span class="n">JavaVM</span><span class="w"> </span><span class="o">*</span><span class="n">vm</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">reserved</span><span class="p">);</span>
</code></pre></div>
<p>当包含静态链接本地库'L'的类加载器被垃圾回收时，如果导出了<code>JNI_OnUnload_L</code>函数，则VM将调用该库的<code>JNI_OnUnload_L</code>函数。</p>
<h3 id="api_1">调用API函数</h3>
<p><code>JavaVM</code>类型是指向调用API函数表的指针。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">JNIInvokeInterface</span><span class="w"> </span><span class="o">*</span><span class="n">JavaVM</span><span class="p">;</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">JNIInvokeInterface</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">    </span><span class="nb">NULL</span><span class="p">,</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">    </span><span class="nb">NULL</span><span class="p">,</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">    </span><span class="nb">NULL</span><span class="p">,</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">    </span><span class="n">DestroyJavaVM</span><span class="p">,</span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">    </span><span class="n">AttachCurrentThread</span><span class="p">,</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="w">    </span><span class="n">DetachCurrentThread</span><span class="p">,</span>
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="w">    </span><span class="n">GetEnv</span><span class="p">,</span>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="w">    </span><span class="n">AttachCurrentThreadAsDaemon</span>
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="p">};</span>
</code></pre></div>
<h4 id="jni_getdefaultjavavminitargs">JNI_GetDefaultJavaVMInitArgs</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1">// vm_args: JavaVMInitArgs结构的指针，不能为NULL</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="c1">// 如果支持请求的版本，则返回JNI_OK；如果不支持请求的版本，则返回JNI错误代码（负数）</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="n">jint</span><span class="w"> </span><span class="nf">JNI_GetDefaultJavaVMInitArgs</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">vm_args</span><span class="p">);</span>
</code></pre></div>
<p>返回Java VM的默认配置。在调用此函数之前，本机代码必须将<code>vm_args-&gt;version</code>字段设置为它期望VM支持的JNI版本。</p>
<ul>
<li>此函数返回后，vm_args-&gt;version将设置为VM支持的实际JNI版本。  </li>
</ul>
<h4 id="jni_getcreatedjavavms">JNI_GetCreatedJavaVMs</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1">// vmBuf：指向将放置VM结构的缓冲区的指针，不能为NULL</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="c1">// 成功时返回JNI_OK；失败时返回适当的JNI错误代码（负数）。</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="n">jint</span><span class="w"> </span><span class="nf">JNI_GetCreatedJavaVMs</span><span class="p">(</span><span class="n">JavaVM</span><span class="w"> </span><span class="o">**</span><span class="n">vmBuf</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="n">bufLen</span><span class="p">,</span><span class="w"> </span><span class="n">jsize</span><span class="w"> </span><span class="o">*</span><span class="n">nVMs</span><span class="p">);</span>
</code></pre></div>
<p>返回已创建的所有Java VM。将VM指针按创建顺序写入缓冲区<code>vmBuf</code>。最多将写入<code>bufLen</code>个条目。已创建的VM总数将在<code>\*nVMs</code>中返回。</p>
<ul>
<li>不支持在单个进程中创建多个VM。</li>
</ul>
<h4 id="jni_createjavavm">JNI_CreateJavaVM</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1">// p_vm：指向将放置结果VM结构的位置的指针。不能为NULL。</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="c1">// p_env：指向将放置主线程的JNI接口指针的位置的指针。不能为NULL。</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="c1">// vm_args：Java VM初始化参数。不能为NULL。</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="n">jint</span><span class="w"> </span><span class="nf">JNI_CreateJavaVM</span><span class="p">(</span><span class="n">JavaVM</span><span class="w"> </span><span class="o">**</span><span class="n">p_vm</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="n">p_env</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">vm_args</span><span class="p">);</span>
</code></pre></div>
<p>加载并初始化Java VM。当前线程将附加到Java VM并成为主线程。将<code>p_env</code>参数设置为主线程的JNI接口指针。</p>
<ul>
<li>不支持在单个进程中创建多个VM。</li>
</ul>
<p><code>JavaVMInitArgs</code>结构如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">JavaVMInitArgs</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">    </span><span class="n">jint</span><span class="w"> </span><span class="n">version</span><span class="p">;</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">    </span><span class="n">jint</span><span class="w"> </span><span class="n">nOptions</span><span class="p">;</span><span class="w">  </span><span class="c1">// options 数组的大小</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">    </span><span class="n">JavaVMOption</span><span class="w"> </span><span class="o">*</span><span class="n">options</span><span class="p">;</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">    </span><span class="n">jboolean</span><span class="w"> </span><span class="n">ignoreUnrecognized</span><span class="p">;</span><span class="w"> </span><span class="c1">//为JNI_TRUE时，忽略所有以&quot;-X&quot;或&quot;_&quot;开头的未识别选项字符串</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="p">}</span><span class="w"> </span><span class="n">JavaVMInitArgs</span><span class="p">;</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="c1">// options字段是以下类型的数组：</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">JavaVMOption</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">optionString</span><span class="p">;</span><span class="w">  </span><span class="cm">/* 以默认平台编码的字符串形式表示的选项 */</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">extraInfo</span><span class="p">;</span>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="p">}</span><span class="w"> </span><span class="n">JavaVMOption</span><span class="p">;</span>
</code></pre></div>
<p>示例创建JVM：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">JavaVMInitArgs</span><span class="w"> </span><span class="n">vm_args</span><span class="p">;</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="n">JavaVMOption</span><span class="w"> </span><span class="n">options</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="c1">// 创建JVM，涉及到第三方jar包时，通过**&quot;-Djava.class.path=&lt;path_to_my_java_class&gt;&quot; 指定，无论jar包还是class文件**，不能是目录；</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">optionString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;-Djava.class.path=c:\myclasses&quot;</span><span class="p">;</span><span class="w"> </span><span class="cm">/* 用户类 */</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="n">options</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">optionString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;-Djava.library.path=c:\mylibs&quot;</span><span class="p">;</span><span class="w">  </span><span class="cm">/* 设置本地库路径 */</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="n">options</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">optionString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;-verbose:jni&quot;</span><span class="p">;</span><span class="w">                   </span><span class="cm">/* 打印JNI相关消息 */</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="n">vm_args</span><span class="p">.</span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JNI_VERSION_1_2</span><span class="p">;</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="n">vm_args</span><span class="p">.</span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">options</span><span class="p">;</span>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="n">vm_args</span><span class="p">.</span><span class="n">nOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="n">vm_args</span><span class="p">.</span><span class="n">ignoreUnrecognized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TRUE</span><span class="p">;</span>
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="cm">/* 请注意，在JDK/JRE中，不再需要调用</span>
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="cm"> * JNI_GetDefaultJavaVMInitArgs。</span>
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="cm"> */</span>
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JNI_CreateJavaVM</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vm</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vm_args</span><span class="p">);</span>
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">...</span>
</code></pre></div>
<h4 id="destroyjavavm">DestroyJavaVM</h4>
<p>任何线程，无论是否已附加，都可以调用此函数。如果当前线程未附加，则首先将其附加。如果当前线程已附加，则如果其调用堆栈上有任何Java方法，则出现错误。见<a href="#终止虚拟机">终止虚拟机</a>。</p>
<h4 id="attachcurrentthread">AttachCurrentThread</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">jint</span><span class="w"> </span><span class="nf">AttachCurrentThread</span><span class="p">(</span><span class="n">JavaVM</span><span class="w"> </span><span class="o">*</span><span class="n">vm</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="n">p_env</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">thr_args</span><span class="p">);</span>
</code></pre></div>
<p>将当前线程附加到Java虚拟机作为<em>非守护</em>线程。见<a href="#附加到虚拟机">附加到虚拟机</a>。</p>
<ul>
<li>已经附加的线程的守护状态通过调用此方法不会改变。</li>
<li>当线程附加到VM时，上下文类加载器是引导加载器。</li>
</ul>
<p><code>thr_args</code>：可以为NULL或指向<code>JavaVMAttachArgs</code>结构的指针以指定附加信息：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">JavaVMAttachArgs</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">    </span><span class="n">jint</span><span class="w"> </span><span class="n">version</span><span class="p">;</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span><span class="w">    </span><span class="cm">/* 线程的名称作为修改后的UTF-8字符串，或为NULL */</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">    </span><span class="n">jobject</span><span class="w"> </span><span class="n">group</span><span class="p">;</span><span class="w"> </span><span class="cm">/* ThreadGroup对象的全局引用，或为NULL */</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="p">}</span><span class="w"> </span><span class="n">JavaVMAttachArgs</span>
</code></pre></div>
<h4 id="attachcurrentthreadasdaemon">AttachCurrentThreadAsDaemon</h4>
<p>将当前线程附加到Java虚拟机作为<em>守护</em>线程。</p>
<ul>
<li>已经附加的线程的守护状态通过调用此方法不会改变。</li>
<li>当线程附加到VM时，上下文类加载器是引导加载器。</li>
</ul>
<h4 id="detachcurrentthread">DetachCurrentThread</h4>
<p>将当前线程从Java虚拟机中分离。如果调用堆栈上有Java方法，则线程无法分离自身。</p>
<ul>
<li>主线程可以从VM中分离；尝试分离未附加的线程是一个空操作。</li>
<li>当在一个线程里面调用<strong>AttachCurrentThread</strong>后，如果不需要用的时候一定要<strong>DetachCurrentThread</strong>，否则线程无法正常退出。</li>
</ul>
<h4 id="getenv">GetEnv</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1">// 如果当前线程未附加到VM，则将*env设置为NULL，并返回JNI_EDETACHED。如果指定的版本不受支持，则将*env设置为NULL，并返回JNI_EVERSION。否则，将*env设置为适当的接口，并返回JNI_OK。</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="n">jint</span><span class="w"> </span><span class="nf">GetEnv</span><span class="p">(</span><span class="n">JavaVM</span><span class="w"> </span><span class="o">*</span><span class="n">vm</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="n">p_env</span><span class="p">,</span><span class="w"> </span><span class="n">jint</span><span class="w"> </span><span class="n">version</span><span class="p">);</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="index.html" class="md-footer__link md-footer__link--prev" aria-label="上一页: 概览">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                概览
              </div>
            </div>
          </a>
        
        
          
          <a href="jni_demo.html" class="md-footer__link md-footer__link--next" aria-label="下一页: 示例">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                示例
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.footer", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../.mkdocs/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>