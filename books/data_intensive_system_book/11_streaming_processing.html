
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Compute Science Blog">
      
      
        <meta name="author" content="LiuZhiqiang(刘志强）">
      
      
        <link rel="canonical" href="https://xliuqq.github.io/csblog/books/data_intensive_system_book/11_streaming_processing.html">
      
      
        <link rel="prev" href="10_batch_processing.html">
      
      
        <link rel="next" href="12_the_future.html">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>第十一章：流处理 - XLiu CS Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="XLiu CS Blog" class="md-header__button md-logo" aria-label="XLiu CS Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            XLiu CS Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第十一章：流处理
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/xliuqq/csblog" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    xliuqq/csblog
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../index.html" class="md-tabs__link">
          
  
  
    
  
  博客

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../cloud/index.html" class="md-tabs__link">
          
  
  
    
  
  云原生

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../index.html" class="md-tabs__link">
          
  
  
    
  
  书籍

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../code_guide/design_principle.html" class="md-tabs__link">
          
  
  
    
  
  编程指南

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../languages/java/native/index.html" class="md-tabs__link">
          
  
  
    
  
  编程语言

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../linux/basic.html" class="md-tabs__link">
          
  
  
    
  
  linux

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../web_backend/index.html" class="md-tabs__link">
          
  
  
    
  
  Web后端开发

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../cs/cs_basic.html" class="md-tabs__link">
          
  
  
    
  
  CS基础

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../courses/os_lab/index.html" class="md-tabs__link">
          
  
  
    
  
  课程

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../paper/go_concurrency_bugs.html" class="md-tabs__link">
          
  
  
    
  
  论文

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="XLiu CS Blog" class="md-nav__button md-logo" aria-label="XLiu CS Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    XLiu CS Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/xliuqq/csblog" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    xliuqq/csblog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    博客
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    博客
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    标签
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    归档
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    归档
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2024.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2024
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2023.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    分类
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    分类
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/hdfs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HDFS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/k8s.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    K8s
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/yarn.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Yarn
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/devops.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    devops
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/helm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    helm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/maven.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    maven
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/spark.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    spark
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/%E5%B9%B6%E5%8F%91.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    并发
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../cloud/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    云原生
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    云原生
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../cloud/virtualize/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    虚拟化
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    虚拟化
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/virtualize/lxcfs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    proc虚拟化和共享
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/virtualize/gpu.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    gpu虚拟化
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_2_4" id="__nav_2_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    moby(docker)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    moby(docker)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/virtualize/docker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/virtualize/docker_deploy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    部署配置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/virtualize/docker_cmds.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    使用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/virtualize/containerd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    containerd
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    k8s
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    k8s
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_1" >
        
          
          <label class="md-nav__link" for="__nav_2_3_1" id="__nav_2_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    架构与组件
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    架构与组件
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/k8s.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概述
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/kubelet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kubelet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/k8s_object.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    对象定义
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/k8s_resource.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    内置资源对象
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/pod_inplace_upgrade.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pod原地升级
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/config.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    常用配置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/cmds.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    命令使用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/go_client.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    goclient
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/ui_manager.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UI和管理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/log_arch.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    日志架构
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/k8s_security.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    安全机制
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_11" >
        
          
          <label class="md-nav__link" for="__nav_2_3_11" id="__nav_2_3_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    资源调度
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    资源调度
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/scheduler.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    调度策略
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/scheduler_plugin.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    调度策略
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_12" >
        
          
          <label class="md-nav__link" for="__nav_2_3_12" id="__nav_2_3_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    CRD
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    CRD
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/crd_index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概述
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/crd_kubebuilder.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kubebuilder
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/crd_java.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JavaOperator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/metrics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    指标监控
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/device_plugin.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    设备插件
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/garbage_collect.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    垃圾回收
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/webhook.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Wehhook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/network.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    网络模型
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/extend_csi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    存储模型
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_19" >
        
          
          <label class="md-nav__link" for="__nav_2_3_19" id="__nav_2_3_19_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    安装部署
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_19">
            <span class="md-nav__icon md-icon"></span>
            
  
    安装部署
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/deploy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    部署流程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/deploy_storage.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    存储部署
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/notes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    生产注意事项
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/k8s/release_compare.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    可选发行版
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/helm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    包管理Helm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/habor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    镜像仓库Habor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    无服务化
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    无服务化
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/serverless/serverless.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概述
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/serverless/knative.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    knative
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/serverless/openfaas.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    openfaas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    常用镜像
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    常用镜像
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/images/images.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    常用镜像
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/images/web_centos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    浏览器centos
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/tools.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    镜像工具
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    云边系统
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    云边系统
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/cloud_edge/mqtt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    mqtt协议
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/cloud_edge/openyurt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    openyurt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/cloud_edge/kubeedge.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kubeedge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
        
          
          <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    项目
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    项目
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/projects/HAMi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    vGPU HAMI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/projects/fluid.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    数据编排Fluid
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/projects/istio.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    流量编排Istio
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/projects/kubevela.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    应用交付KubeVela
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    书籍
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    书籍
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    数据密集型系统设计
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    数据密集型系统设计
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="1_data_system_basic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    可靠、可扩展、可维护的应用系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="2_data_model_query_language.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    数据模型和查询语言
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="3_data_store_and_search.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    数据存储与检索
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="4_encoding_and_evolution.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    编码与演化
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="part2_distributed_data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第二部分：分布式数据
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="5_replication.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    复制
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="6_partitions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    分区
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="7_transaction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    事务
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="8_trouble_in_distributed_system.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    分布式系统的麻烦
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="9_consistency_consensus.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    一致性与共识
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="part3_derived_data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第三部分：衍生数据
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="10_batch_processing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第十章：批处理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    第十一章：流处理
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="11_streaming_processing.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    第十一章：流处理
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        传递事件流
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="传递事件流">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        消息传递系统
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="消息传递系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        直接从生产者传递给消费者
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        消息代理
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        消息代理与数据库的对比
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        多个消费者
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        确认与重新传递
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        分区日志
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="分区日志">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用日志进行消息存储
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        日志与传统的消息传递相比
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        消费者偏移量
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        磁盘空间使用
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        当消费者跟不上生产者时
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        重播旧消息
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        数据库与流
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数据库与流">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        保持系统同步
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        变更数据捕获
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="变更数据捕获">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        变更数据捕获的实现
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      
        初始快照
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      
        日志压缩
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      
        变更流的API支持
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      
        事件溯源
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="事件溯源">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      
        从事件日志中派生出当前状态
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      
        命令和事件
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      
        状态、流和不变性
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="状态、流和不变性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      
        不可变事件的优点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      
        从同一事件日志中派生多个视图
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      
        并发控制
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      
        不变性的局限性
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      
        流处理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="流处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      
        流处理的应用
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="流处理的应用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      
        复合事件处理
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      
        流分析
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      
        维护物化视图
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      
        在流上搜索
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rpc" class="md-nav__link">
    <span class="md-ellipsis">
      
        消息传递和RPC
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      
        时间推理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="时间推理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      
        事件时间与处理时间
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      
        知道什么时候准备好了
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      
        你用的是谁的时钟？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      
        窗口的类型
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      
        流连接
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="流连接">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      
        流流连接（窗口连接）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      
        流表连接（流扩充）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      
        表表连接（维护物化视图）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      
        连接的时间依赖性
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      
        容错
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="容错">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      
        微批量与存档点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      
        原子提交再现
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      
        幂等性
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      
        失败后重建状态
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      
        本章小结
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      
        参考文献
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="12_the_future.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第十二章：数据系统的未来
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    编程指南
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    编程指南
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_principle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    设计原则
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../code_guide/design_pattern/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    设计模式
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    设计模式
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    创建型模式
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    创建型模式
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/factory.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    工厂模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/abstract_factory.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    抽象工厂
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/singleton.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    单例
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/builder.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    构造者模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/prototype.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    原型模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_3" id="__nav_4_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    结构型模式
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    结构型模式
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/adapter.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    适配器模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/bridge.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    桥接模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/composite.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    组合模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/decorator.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    装饰模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/facade.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    外观模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/flyweight.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    享元模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/proxy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    代理模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_4" >
        
          
          <label class="md-nav__link" for="__nav_4_2_4" id="__nav_4_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    行为型模式
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    行为型模式
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/chain.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    职责链模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/command.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    命令模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/interpret.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    解释器模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/iterator.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    迭代器模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/medium.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    中介者模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/memento.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    备忘录模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/observer.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    观察者模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/state.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    状态模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/strategy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    策略模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/template.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    模板方法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/visitor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    访问者模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/design_pattern/container_distributed.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    分布式应用设计模式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/clean_code.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    整洁代码
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../code_guide/algs/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    算法
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    算法
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/algs/hash.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    散列算法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/algs/bloom_filter.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    布隆过滤器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    数据结构
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    数据结构
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/data_structure/array.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    数组
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/data_structure/list.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    链表
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/data_structure/queue.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    队列
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/data_structure/hashmap.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hash表
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_guide/data_structure/tree.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    树
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    编程语言
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    编程语言
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Java
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Java
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../languages/java/native/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Native
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1" id="__nav_5_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Native
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_1_2" id="__nav_5_1_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    JNI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    JNI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/java/native/jni.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    原理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/java/native/jni_demo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    示例
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/java/native/jnr.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JNR
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/java/jmh.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基准测试
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/java/packages/tools.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    工具包
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    C和C++
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    C和C++
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/ccpp/basic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/ccpp/class.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    类
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/ccpp/concurrency.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    并发
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/ccpp/debug.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    调试
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/ccpp/call_python.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CallPython
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/ccpp/abi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ABI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/ccpp/gcc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    gcc
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/ccpp/make.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    make
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/libffi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ffi
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/unicode.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    unicode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../languages/ziju.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    语言自举
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    linux
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/basic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/shell_programming.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    shell编程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/tuning.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    性能调试命令
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/bash.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    bash
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/chmod.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    chmod
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/chroot.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    chroot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/binutils.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    gnu工具
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/firewall.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    防火墙
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/namespace.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    名空间
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cgroup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/limit_process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    进程的限制
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/systemctl.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    systemctl
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/log_and_rotate.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    日志管理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/process_snapshot.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    进程快照
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/acls.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    acls
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/network.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    网络
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/fs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    文件系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/zero_copy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    零拷贝
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/yum.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    源配置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../web_backend/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Web后端开发
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Web后端开发
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../web_backend/aop_java.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    切面编程(Java)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../web_backend/cache.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    缓存
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    CS基础
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    CS基础
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/cs_basic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/cs_os.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    操作系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../cs/network/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    网络
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    网络
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/network/network.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    网络层协议
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/network/trans_protocols.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    传输层协议
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/network/http.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HTTP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/network/intranet_penetration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    内网穿透
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/network/LVS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LVS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    课程
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    课程
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../courses/os_lab/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    操作系统设计与实现(2023)
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9_1" id="__nav_9_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    操作系统设计与实现(2023)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/01-os_introduction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.操作系统概述
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/02-os_appview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2.应用视角的操作系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/03-os_hardware_view.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3.硬件视角的操作系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/04-os_python_modeling.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4.Python 建模操作系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/05_multi_cpu_programming.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5.多处理器编程：从入门到放弃
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/06_concurrent_control_basic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6.应用视角的操作系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/07_concurrent_control_mutex.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7.并发控制：互斥
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/08_debug_and_action.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8.调试理论与实践
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/09_sync_condition.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9.并发控制：同步（条件变量）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/10_sync_semphore.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10.并发控制：同步（信号量）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/11_concurrent_in_real_world.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11.真实世界的并发编程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/12_concurrent_bug_category.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12.并发BUG分类
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/13_concurrent_bug_defense.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13.并发 Bug 的应对
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/14_multi_cpu_and_interrupt.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14.多处理器系统与中断机制
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/15_kernel_thread_and_process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15.操作系统上的进程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/16_application_in_linux.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16.Linux 操作系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/17_hack_linux_process_address.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17.Linux 进程的地址空间
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/18_os_lab_live_guide.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18.操作系统实验生存指南
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/19_system_call_and_shell.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19.系统调用和 UNIX Shell
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/20-c_standard_lib.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20.C标准库和实现
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/21-22-executable_files_loading.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21-22.可执行文件与加载
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/23_application_of_state_machine.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    23.状态机模型的应用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/24_impletation_of_os_process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    24.操作系统进程的实现
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/25_store_device.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    25.存储设备原理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/26_input_output_device.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    26.输入输出设备
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/27_device_driver_and_filesystem.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    27.设备驱动程序与文件系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/28_FAT_UNIX_filesystem.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    28.FAT 和 UNIX 文件系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/29_available_durable_data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    29.持久数据的可靠性
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/os_lab/30_summarize.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    30.课程总结
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    论文
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    论文
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/go_concurrency_bugs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    go并发bugs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/scalability_but_at_what_cost.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    可扩展性的代价
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../paper/large_fs_for_containers.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    大规模容器文件系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        传递事件流
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="传递事件流">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        消息传递系统
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="消息传递系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        直接从生产者传递给消费者
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        消息代理
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        消息代理与数据库的对比
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        多个消费者
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        确认与重新传递
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        分区日志
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="分区日志">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用日志进行消息存储
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        日志与传统的消息传递相比
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        消费者偏移量
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        磁盘空间使用
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        当消费者跟不上生产者时
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        重播旧消息
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        数据库与流
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数据库与流">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        保持系统同步
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        变更数据捕获
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="变更数据捕获">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        变更数据捕获的实现
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      
        初始快照
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      
        日志压缩
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      
        变更流的API支持
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      
        事件溯源
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="事件溯源">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      
        从事件日志中派生出当前状态
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      
        命令和事件
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      
        状态、流和不变性
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="状态、流和不变性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      
        不可变事件的优点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      
        从同一事件日志中派生多个视图
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      
        并发控制
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      
        不变性的局限性
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      
        流处理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="流处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      
        流处理的应用
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="流处理的应用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      
        复合事件处理
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      
        流分析
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      
        维护物化视图
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      
        在流上搜索
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rpc" class="md-nav__link">
    <span class="md-ellipsis">
      
        消息传递和RPC
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      
        时间推理
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="时间推理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      
        事件时间与处理时间
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      
        知道什么时候准备好了
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      
        你用的是谁的时钟？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      
        窗口的类型
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      
        流连接
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="流连接">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      
        流流连接（窗口连接）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      
        流表连接（流扩充）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      
        表表连接（维护物化视图）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      
        连接的时间依赖性
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      
        容错
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="容错">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      
        微批量与存档点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      
        原子提交再现
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      
        幂等性
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      
        失败后重建状态
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      
        本章小结
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      
        参考文献
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="_1">第十一章：流处理</h1>
<p>很多数据是 <strong>无界限</strong> 的，因为它随着时间的推移而逐渐到达：用户在昨天和今天产生了数据，明天他们将继续产生更多的数据。这些数据集从来就不会以任何有意义的方式 “完成”【1】。</p>
<ul>
<li>批处理程序必须将数据人为地分成固定时间段的数据块，例如，在每天结束时处理一天的数据，或者在每小时结束时处理一小时的数据。</li>
</ul>
<p>为了减少延迟，我们可以更频繁地运行处理 ，如在每秒钟的末尾。或者更连续，当事件发生时就立即进行处理，这就是 <strong>流处理（stream processing）</strong> 背后的想法。</p>
<p>一般来说，“流” 是指随着时间的推移逐渐可用的数据。这个概念出现在很多地方：Unix 的 stdin 和 stdout、编程语言（惰性列表）【2】、文件系统 API（如 Java 的 <code>FileInputStream</code>）、TCP 连接、通过互联网传送音频和视频等等。</p>
<p>本章把 <strong>事件流（event stream）</strong> 视为一种数据管理机制：无界限，增量处理，与上一章中的批量数据相对应。</p>
<h2 id="_2">传递事件流</h2>
<p>在流处理的上下文中，记录通常被叫做 <strong>事件（event）</strong> ：一个小的、自包含的、不可变的对象，包含某个时间点发生的某件事情的细节。通常包含一个来自日历时钟的时间戳，以指明事件发生的时间。</p>
<p>事件可能被编码为文本字符串或 JSON，或者某种二进制编码。可以存储一个事件，将其追加到一个文件，将其插入关系表，或将其写入文档数据库，通过网络发送等。</p>
<p>流处理术语中，一个事件由 <strong>生产者（producer）</strong> （也称为 <strong>发布者（publisher）</strong> 或 <strong>发送者（sender）</strong> ）生成一次，然后可能由多个 <strong>消费者（consumer）</strong> （ <strong>订阅者（subscribers）</strong> 或 <strong>接收者（recipients）</strong> ）进行处理【3】。</p>
<p>在文件系统中，文件名标识一组相关记录；在流式系统中，相关的事件通常被聚合为一个 <strong>主题（topic）</strong> 或 <strong>流（stream）</strong> 。</p>
<p>原则上讲，文件或数据库就足以连接生产者和消费者：生产者将其生成的每个事件写入数据存储，且每个消费者定期轮询数据存储，检查自上次运行以来新出现的事件。这实际上正是批处理在每天结束时处理当天数据时所做的事情。</p>
<ul>
<li>低延迟的连续处理：如果数据存储不是为这种用途专门设计的，那么轮询开销就会很大。</li>
<li>关系型数据库通常有 <strong>触发器（trigger）</strong>，但是它们的功能非常有限，并且在数据库设计中有些后顾之忧【4,5】。</li>
</ul>
<h3 id="_3">消息传递系统</h3>
<p>向消费者通知新事件的常用方式是使用 <strong>消息传递系统（messaging system）</strong>：生产者发送包含事件的消息，然后将消息推送给消费者。</p>
<p>Unix 管道和 TCP 将恰好一个发送者与恰好一个接收者连接。而一个消息传递系统允许多个生产者节点将消息发送到同一个主题，并允许多个消费者节点接收主题中的消息。</p>
<p>在这个 <strong>发布 / 订阅</strong> 模式中，不同的系统采取各种各样的方法，并没有针对所有目的的通用答案。</p>
<ul>
<li><strong>如果生产者发送消息的速度比消费者能够处理的速度快会发生什么</strong></li>
<li>丢掉消息、将消息放入缓冲队列、或使用 <strong>背压</strong>（backpressure，也称为 <strong>流量控制</strong>，即 flow control：阻塞生产者，以免其发送更多的消息）。</li>
<li>Unix 管道和 TCP 就使用了背压：它们有一个固定大小的小缓冲区，如果填满，发送者会被阻塞，直到接收者从缓冲区中取出数据。</li>
<li><strong>如果节点崩溃或暂时脱机，会发生什么情况？ —— 是否会有消息丢失？</strong></li>
<li>持久性可能需要写入磁盘和 / 或复制的某种组合这是有代价的。如果你能接受有时消息会丢失，则可能在同一硬件上获得更高的吞吐量和更低的延迟。</li>
</ul>
<p>是否可以接受消息丢失取决于应用：</p>
<ul>
<li>对于周期传输的传感器读数和指标，偶尔丢失的数据点可能并不重要，新值短时间内会再发出；如果大量的消息被丢弃，可能无法立刻意识到指标已经不正确了【7】</li>
<li>如果你正在对事件计数，那么它们能够可靠送达是更重要的，因为每个丢失的消息都意味着使计数器的错误扩大</li>
</ul>
<h4 id="_4">直接从生产者传递给消费者</h4>
<p>许多消息传递系统使用生产者和消费者之间的直接网络通信，而不通过中间节点：</p>
<ul>
<li>UDP 组播广泛应用于金融行业，例如股票市场，其中低时延非常重要【8】。UDP虽然不可靠，但应用层的协议可以恢复丢失的数据包（生产者必须记住它发送的数据包，以便能按需重新发送数据包）。</li>
<li>无代理的消息库，如 ZeroMQ 【9】和 nanomsg 。通过 TCP 或 IP 多播实现发布 / 订阅消息传递。</li>
<li>StatsD 【10，11】和 Brubeck 【7】使用不可靠的 UDP 消息传递来收集网络中所有机器的指标并对其进行监控。</li>
<li>如果消费者在网络上公开了服务，生产者可以直接发送 HTTP 或 RPC 请求将消息推送给使用者。这就是 webhooks 背后的想法【12】。</li>
</ul>
<p>直接消息传递系统通常要求应用代码意识到消息丢失的可能性。容错程度极为有限：即使协议检测到并重传在网络中丢失的数据包，它们通常也只是假设生产者和消费者始终在线。</p>
<p>如果消费者处于脱机状态，则可能会丢失其不可达时发送的消息。一些协议允许生产者重试失败的消息传递，但当生产者崩溃时，它可能会丢失消息缓冲区及其本应发送的消息，这种方法可能就没用了。</p>
<h4 id="_5">消息代理</h4>
<p>一种广泛使用的替代方法是通过 <strong>消息代理</strong>（message broker，也称为 <strong>消息队列</strong>，即 message queue）发送消息。</p>
<ul>
<li>消息代理实质上是一种针对处理消息流而优化的数据库；</li>
<li>作为服务器运行，生产者和消费者作为客户端连接到服务器。生产者将消息写入代理，消费者通过从代理那里读取来接收消息。</li>
</ul>
<p>将数据集中在代理上，这些系统可以更容易地容忍来来去去的客户端（连接，断开连接和崩溃），而持久性问题则转移到代理的身上。</p>
<ul>
<li>一些消息代理只将消息保存在内存中，而另一些消息代理（取决于配置）将其写入磁盘，以便在代理崩溃的情况下不会丢失。</li>
<li>针对缓慢的消费者，它们通常会允许无上限的排队（而不是丢弃消息或背压），尽管这种选择也可能取决于配置。</li>
</ul>
<p>排队的结果是，消费者通常是 <strong>异步（asynchronous）</strong> 的：当生产者发送消息时，通常只会等待代理确认消息已经被缓存，而不等待消息被消费者处理。向消费者递送消息将发生在未来某个未定的时间点 —— 通常在几分之一秒之内，但有时当消息堆积时会显著延迟。</p>
<h4 id="_6">消息代理与数据库的对比</h4>
<p>有些消息代理甚至可以使用 XA 或 JTA 参与两阶段提交协议（请参阅 “<a href="9_consistency_consensus.html#实践中的分布式事务">实践中的分布式事务</a>”），但消息代理和数据库之间仍存在实践上很重要的差异：</p>
<ul>
<li>数据库通常保留数据直至显式删除，而大多数消息代理在消息成功递送给消费者时会自动删除消息。</li>
<li>由于它们很快就能删除消息，大多数消息代理都认为它们的工作集相当小。如果代理需要缓冲很多消息，比如因为消费者速度较慢（如果内存装不下消息，可能会溢出到磁盘），每个消息需要更长的处理时间，整体吞吐量可能会恶化【6】。</li>
<li>数据库通常支持次级索引和各种搜索数据的方式，而消息代理通常支持按照某种模式匹配主题，订阅其子集。</li>
<li>查询数据库时，结果通常基于某个时间点的数据快照；如果另一个客户端随后向数据库写入一些改变了查询结果的内容，则第一个客户端不会发现其先前结果现已过期（除非它重复查询或轮询变更）。相比之下，消息代理不支持任意查询，但是当数据发生变化时（即新消息可用时），它们会通知客户端。</li>
</ul>
<p>这是关于消息代理的传统观点，它被封装在诸如 JMS 【14】和 AMQP 【15】的标准中，并且被诸如 RabbitMQ、ActiveMQ、HornetQ、Qpid、TIBCO 企业消息服务、IBM MQ、Azure Service Bus 和 Google Cloud Pub/Sub 所实现 【16】。</p>
<h4 id="_7">多个消费者</h4>
<p>当多个消费者从同一主题中读取消息时，有两种主要的消息传递模式，如 图 11-1 所示：</p>
<ul>
<li>负载均衡（load balancing）：每条消息都被传递给消费者 <strong>之一</strong></li>
<li>代理可以为消费者任意分配消息。当处理消息的代价高昂，希望能并行处理消息时，此模式非常有用</li>
<li>扇出（fan-out）：每条消息都被传递给 <strong>所有</strong> 消费者</li>
<li>几个独立的消费者各自 “收听” 相同的消息广播，对应批处理中多个不同批处理作业读取同一份输入文件</li>
</ul>
<p><img alt="img" src="pics/fig11-1.png" /></p>
<center><b>图 11-1 （a）负载平衡：在消费者间共享消费主题；（b）扇出：将每条消息传递给多个消费者。</b></center>

<p>两种模式可以组合使用：例如，两个独立的消费者组可以每组各订阅同一个主题，每一组都共同收到所有消息，但在每一组内部，每条消息仅由单个节点处理。</p>
<h4 id="_8">确认与重新传递</h4>
<p>消费者随时可能会崩溃，所以有一种可能的情况是：代理向消费者递送消息，但消费者没有处理，或者在消费者崩溃之前只进行了部分处理。</p>
<ul>
<li>消息代理使用 <strong>确认（acknowledgments）</strong>：客户端必须显式告知代理消息处理完毕的时间，以便代理能将消息从队列中移除。</li>
</ul>
<p>如果与客户端的连接关闭，或者代理超出一段时间未收到确认，代理则认为消息没有被处理，因此它将消息再递送给另一个消费者。</p>
<ul>
<li>可能发生这样的情况，消息 <strong>实际上是</strong> 处理完毕的，但 <strong>确认</strong> 在网络中丢失了。需要一种原子提交协议才能处理这种情况。</li>
</ul>
<p>当与负载均衡相结合时，这种重传行为对消息的顺序有种有趣的影响。如下图所示：</p>
<ul>
<li>消费者通常按照生产者发送的顺序处理消息。消费者 2 在处理消息 m3 时崩溃，与此同时消费者 1 正在处理消息 m4。</li>
<li>未确认的消息 m3 随后被重新发送给消费者 1，结果消费者 1 按照 m4，m3，m5 的顺序处理消息。</li>
<li>因此 m3 和 m4 的交付顺序与生产者 1 的发送顺序不同。</li>
</ul>
<p><img alt="img" src="pics/fig11-2.png" /></p>
<center><b>图 11-2 在处理 m3 时消费者 2 崩溃，因此稍后重传至消费者 1</b></center>

<p>即使消息代理试图保留消息的顺序（如 JMS 和 AMQP 标准所要求的），负载均衡与重传的组合也不可避免地导致消息被重新排序。</p>
<ul>
<li>为避免此问题，你可以让每个消费者使用单独的队列（即不使用负载均衡功能）。</li>
<li>如果消息之间存在因果依赖关系，这就是一个很重要的问题。</li>
</ul>
<h3 id="_9">分区日志</h3>
<p><strong>基于日志的消息代理（log-based message brokers）</strong> ：既有数据库的持久存储方式，又有消息传递的低延迟通知。</p>
<ul>
<li>AMQP/JMS 风格的消息传递的问题：收到消息是具有破坏性的，因为确认可能导致消息从代理中被删除，因此你不能期望再次运行同一个消费者能得到相同的结果。</li>
</ul>
<h4 id="_10">使用日志进行消息存储</h4>
<p>日志只是磁盘上简单的仅追加记录序列。同样的结构可以用于实现消息代理：</p>
<ul>
<li>生产者通过将消息追加到日志末尾来发送消息，而消费者通过依次读取日志来接收消息。</li>
<li>如果消费者读到日志末尾，则会等待新消息追加的通知。</li>
<li>Unix 工具 <code>tail -f</code> 能监视文件被追加写入的数据，基本上就是这样工作的。</li>
</ul>
<p>为了伸缩超出单个磁盘所能提供的更高吞吐量，可以对日志进行 <strong>分区</strong>：</p>
<ul>
<li>不同的分区可以托管在不同的机器上，使得每个分区都有一份能独立于其他分区进行读写的日志。</li>
<li>一个主题可以定义为一组携带相同类型消息的分区。</li>
</ul>
<p>如下图11-3所示：</p>
<ul>
<li>在每个分区内，代理为每个消息分配一个单调递增的序列号或 <strong>偏移量</strong>（offset，框中的数字是消息偏移量）。</li>
<li>这种序列号是有意义的，因为分区是仅追加写入的，所以分区内的消息是完全有序的。</li>
<li>没有跨不同分区的顺序保证。</li>
</ul>
<p><img alt="img" src="pics/fig11-3.png" /></p>
<center><b>图 11-3 生产者通过将消息追加写入主题分区文件来发送消息，消费者依次读取这些文件</b></center>

<p>Apache Kafka 【17,18】、Amazon Kinesis Streams 【19】和 Twitter 的 DistributedLog 【20,21】都是基于日志的消息代理。Google Cloud Pub/Sub 在架构上类似，但对外暴露的是 JMS 风格的 API，而不是日志抽象【16】。</p>
<p>尽管这些消息代理将所有消息写入磁盘，但通过跨多台机器分区，每秒能够实现数百万条消息的吞吐量，并通过复制消息来实现容错性【22,23】。</p>
<h4 id="_11">日志与传统的消息传递相比</h4>
<p>基于日志的方法天然支持扇出式消息传递，因为多个消费者可以独立读取日志，而不会相互影响—— 读取消息不会将其从日志中删除。</p>
<p>为了在一组消费者之间实现负载平衡，代理可以将整个分区分配给消费者组中的节点，而不是将单条消息分配给消费者客户端。每个客户端将消费被指派分区中的 <strong>所有</strong> 消息。</p>
<p>通常情况下，当一个用户被指派了一个日志分区时，它会以简单的单线程方式顺序地读取分区中的消息。这种粗粒度的负载均衡方法有一些缺点：</p>
<ul>
<li>
<p>共享消费主题工作的节点数，最多为该主题中的日志分区数，因为同一个分区内的所有消息被递送到同一个节点 <sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>。</p>
</li>
<li>
<p>如果某条消息处理缓慢，则它会阻塞该分区中后续消息的处理（一种行首阻塞的形式）。</p>
</li>
</ul>
<h4 id="_12">消费者偏移量</h4>
<p>顺序消费一个分区使得判断消息是否已经被处理变得相当容易：所有偏移量小于消费者的当前偏移量的消息已经被处理，而具有更大偏移量的消息还没有被看到。</p>
<ul>
<li>代理不需要跟踪确认每条消息，只需要定期记录消费者的偏移即可。提高基于日志的系统的吞吐量。</li>
</ul>
<p>这种偏移量与单领导者数据库复制中常见的日志序列号非常相似，日志序列号允许跟随者断开连接后，重新连接到领导者，并在不跳过任何写入的情况下恢复复制。这里原理完全相同：消息代理表现得像一个主库，而消费者就像一个从库。</p>
<p>如果消费者节点失效，则失效消费者的分区将指派给其他节点，并从最后记录的偏移量开始消费消息。如果消费者已经处理了后续的消息，但还没有记录它们的偏移量，那么重启后这些消息<strong>将被处理两次</strong>。本章后面讨论这个问题的处理方法。</p>
<h4 id="_13">磁盘空间使用</h4>
<p>为了回收磁盘空间，日志实际上被分割成段，并不时地将旧段删除或移动到归档存储。</p>
<ul>
<li>
<p>如果一个慢消费者跟不上消息产生的速率而落后得太多，它的消费偏移量指向了删除的段，那么它就会错过一些消息。</p>
</li>
<li>
<p>日志实现了一个有限大小的缓冲区，当缓冲区填满时会丢弃旧消息，它也被称为 <strong>循环缓冲区（circular buffer）</strong> 或 <strong>环形缓冲区（ring buffer）</strong>。</p>
</li>
</ul>
<p>由于缓冲区在磁盘上，因此缓冲区可能相当的大。做个简单计算：</p>
<ul>
<li>在撰写本文时，典型的大型硬盘容量为 6TB，顺序写入吞吐量为 150MB/s。</li>
<li>以最快的速度写消息，则需要大约 11 个小时才能填满磁盘。</li>
<li>因而磁盘可以缓冲 11 个小时的消息，之后它将开始覆盖旧的消息。</li>
</ul>
<p>实践中的部署很少能用满磁盘的写入带宽，所以通常可以保存一个几天甚至几周的日志缓冲区。</p>
<p>不管保留多长时间的消息，日志的吞吐量或多或少保持不变，因为无论如何，每个消息都会被写入磁盘【18】。这种行为与默认将消息保存在内存中，仅当队列太长时才写入磁盘的消息传递系统形成鲜明对比。</p>
<ul>
<li>当队列很短时，这些系统非常快；而当这些系统开始写入磁盘时，就要慢的多，所以吞吐量取决于保留的历史数量。</li>
</ul>
<h4 id="_14">当消费者跟不上生产者时</h4>
<p>如果消费者无法跟上生产者发送信息的速度时，我们讨论了三种选择：丢弃信息，进行缓冲或施加背压。</p>
<ul>
<li>基于日志的方法是缓冲的一种形式，具有很大但大小固定的缓冲区（受可用磁盘空间的限制）。</li>
</ul>
<p>如果消费者远远落后，而所要求的信息比保留在磁盘上的信息还要旧，那么它将不能读取这些信息，所以代理实际上丢弃了比缓冲区容量更大的旧信息。</p>
<ul>
<li>监控消费者落后日志头部的距离，如果落后太多就发出报警。</li>
<li>由于缓冲区很大，因而有足够的时间让运维人员来修复慢消费者，并在消息开始丢失之前让其赶上。</li>
</ul>
<p>即使消费者真的落后太多开始丢失消息，也只有那个消费者受到影响；它不会中断其他消费者的服务。</p>
<ul>
<li>可以实验性地消费生产日志，以进行开发，测试或调试，而不必担心会中断生产服务。</li>
<li>当消费者关闭或崩溃时，会停止消耗资源，唯一剩下的只有消费者偏移量。</li>
</ul>
<p>这种行为也与传统的消息代理形成了鲜明对比，在那种情况下，你需要小心地删除那些消费者已经关闭的队列 —— 否则那些队列就会累积不必要的消息，从其他仍活跃的消费者那里占走内存。</p>
<h4 id="_15">重播旧消息</h4>
<p>除了消费者的任何输出之外，处理的唯一副作用是消费者偏移量的前进。但偏移量是在消费者的控制之下的，所以如果需要的话可以很容易地操纵：</p>
<ul>
<li>可以用昨天的偏移量跑一个消费者副本，并将输出写到不同的位置，以便重新处理最近一天的消息。</li>
<li>使得基于日志的消息传递更像上一章的批处理，其中衍生数据通过可重复的转换过程与输入数据显式分离。</li>
<li>允许进行更多的实验，更容易从错误和漏洞中恢复，使其成为在组织内集成数据流的良好工具【24】。</li>
</ul>
<h2 id="_16">数据库与流</h2>
<p>从消息传递和流中获取灵感，并将它们应用于数据库。</p>
<p>事件是某个时刻发生的事情的记录。发生的事情可能是用户操作（例如键入搜索查询）或读取传感器，但也可能是 <strong>写入数据库</strong>。某些东西被写入数据库的事实是可以被捕获、存储和处理的事件。</p>
<p>事实上，复制日志是一个由数据库写入事件组成的流，由主库在处理事务时生成。从库将写入流应用到它们自己的数据库副本，从而最终得到相同数据的精确副本。复制日志中的事件描述发生的数据更改。</p>
<p>状态机复制原理，其中指出：如果每个事件代表对数据库的写入，并且每个副本按相同的顺序处理相同的事件，则副本将达到相同的最终状态 （假设事件处理是一个确定性的操作）。这是事件流的又一种场景！</p>
<h3 id="_17">保持系统同步</h3>
<p>没有一个系统能够满足所有的数据存储、查询和处理需求。在实践中，大多数重要应用都需要组合使用几种不同的技术来满足所有的需求：</p>
<ul>
<li>使用 OLTP 数据库来为用户请求提供服务，使用缓存来加速常见请求，使用全文索引来处理搜索查询，使用数据仓库用于分析。</li>
</ul>
<p>由于相同或相关的数据出现在了不同的地方，因此相互间需要保持同步：如果某个项目在数据库中被更新，它也应当在缓存、搜索索引和数据仓库中被更新。</p>
<ul>
<li>对于数据仓库，这种同步通常由 ETL 进程执行。通常是先取得数据库的完整副本，然后执行转换，并批量加载到数据仓库中。</li>
</ul>
<p>如果周期性的完整数据库转储过于缓慢，有时会使用的替代方法是 <strong>双写（dual write）</strong>。
- 应用代码在数据变更时明确写入每个系统：例如，首先写入数据库，然后更新搜索索引，然后使缓存项失效（甚至同时执行这些写入）。</p>
<p>双写有一些严重的问题，其中一个是竞争条件，如图 11-4 所示：</p>
<ul>
<li>两个客户端同时想要更新一个项目 X：客户端 1 想要将值设置为 A，客户端 2 想要将其设置为 B。</li>
<li>两个客户端首先将新值写入数据库，然后将其写入到搜索索引。</li>
</ul>
<p>但运气不好，这些请求的时序是交错的：</p>
<ul>
<li>数据库首先看到来自客户端 1 的写入将值设置为 A，然后来自客户端 2 的写入将值设置为 B，因此数据库中的最终值为 B。</li>
<li>搜索索引首先看到来自客户端 2 的写入，然后是客户端 1 的写入，所以搜索索引中的最终值是 A。</li>
<li>即使没发生错误，这两个系统现在也永久地不一致了。</li>
</ul>
<p><img alt="img" src="pics/fig11-4.png" /></p>
<center><b>图 11-4 在数据库中 X 首先被设置为 A，然后被设置为 B，而在搜索索引处，写入以相反的顺序到达</b></center>

<p>除非有一些额外的并发检测机制，例如我们在 “<a href="5_replication.html#检测并发写入">检测并发写入</a>” 中讨论的版本向量，否则你甚至不会意识到发生了并发写入 —— 一个值将简单地以无提示方式覆盖另一个值。</p>
<p>双重写入的另一个问题是，其中一个写入可能会失败，而另一个成功。</p>
<ul>
<li>这是一个容错问题，而不是一个并发问题，但也会造成两个系统互相不一致的结果。</li>
<li>确保它们要么都成功要么都失败，是原子提交问题的一个例子，解决这个问题的代价是昂贵的（请参阅 “<a href="9_consistency_consensus.html#原子提交与两阶段提交">原子提交与两阶段提交</a>”）。</li>
</ul>
<p>如果实际上只有一个领导者 —— 例如，数据库 —— 而且我们能让搜索索引成为数据库的追随者，情况要好得多。但这在实践中可能吗？</p>
<h3 id="_18">变更数据捕获</h3>
<p>大多数数据库的复制日志的问题在于，它们一直被当做数据库的内部实现细节，而不是公开的 API。客户端应该通过其数据模型和查询语言来查询数据库，而不是解析复制日志并尝试从中提取数据。</p>
<p><strong>变更数据捕获（change data capture, CDC）</strong>：观察写入数据库的所有数据变更，并将其提取并转换为可以复制到其他系统中的形式的过程。</p>
<p>CDC 当变更能在被写入后立刻用于流时。例如可以捕获数据库中的变更，并不断将相同的变更应用至搜索索引。如果变更日志以相同的顺序应用，则可以预期搜索索引中的数据与数据库中的数据是匹配的。搜索索引和任何其他衍生数据系统只是变更流的消费者。如下图所示：</p>
<p><img alt="img" src="pics/fig11-5.png" /></p>
<center><b>图 11-5 将数据按顺序写入一个数据库，然后按照相同的顺序将这些更改应用到其他系统</b></center>

<h4 id="_19">变更数据捕获的实现</h4>
<p>可以将日志消费者叫做 <strong>衍生数据系统</strong>：在搜索索引和数据仓库中的数据，只是 <strong>记录系统</strong> 数据的额外视图。变更数据捕获是一种机制，可确保对记录系统所做的所有更改都反映在衍生数据系统中，以便衍生系统具有数据的准确副本。</p>
<p>从本质上说，变更数据捕获使得一个数据库成为领导者（被捕获变化的数据库），并将其他组件变为追随者。基于日志的消息代理非常适合从源数据库传输变更事件，因为它保留了消息的顺序。</p>
<p>数据库触发器可用来实现变更数据捕获，通过注册观察所有变更的触发器，并将相应的变更项写入变更日志表中。</p>
<ul>
<li>但是它们往往是脆弱的，而且有显著的性能开销。</li>
</ul>
<p>解析复制日志可能是一种更稳健的方法，但它也很有挑战，例如如何应对模式变更。</p>
<ul>
<li>LinkedIn 的 Databus【25】，Facebook 的 Wormhole【26】和 Yahoo! 的 Sherpa【27】大规模地应用这个思路；</li>
<li>Bottled Water 使用解码 WAL 的 API 实现了 PostgreSQL 的 CDC【28】；Maxwell 和 Debezium 通过解析 binlog 对 MySQL 做了类似的事情【29,30,31】；Mongoriver 读取 MongoDB oplog【32,33】； GoldenGate 为 Oracle 提供类似的功能【34,35】。</li>
</ul>
<p>类似于消息代理，变更数据捕获通常是异步的：记录数据库系统在提交变更之前不会等待消费者应用变更。</p>
<ul>
<li>添加缓慢的消费者不会过度影响记录系统，不过，所有复制延迟可能有的问题在这里都可能出现。</li>
</ul>
<h4 id="_20">初始快照</h4>
<p>如果你拥有 <strong>所有</strong> 对数据库进行变更的日志，则可以通过重播该日志，来重建数据库的完整状态。</p>
<ul>
<li>永远保留所有更改会耗费太多磁盘空间，且重播过于费时，因此日志需要被截断。</li>
</ul>
<p>例如，构建新的全文索引需要整个数据库的完整副本 —— 仅仅应用最近变更的日志是不够的，因为这样会丢失最近未曾更新的项目。</p>
<ul>
<li>如果你没有完整的历史日志，则需要从一个一致的快照开始；</li>
<li>数据库的快照必须与变更日志中的已知位置或偏移量相对应，以便在处理完快照后知道从哪里开始应用变更</li>
</ul>
<h4 id="_21">日志压缩</h4>
<p>如果你只能保留有限的历史日志，则每次要添加新的衍生数据系统时，都需要做一次快照。但 <strong>日志压缩（log compaction）</strong> 提供了一个很好的备选方案。</p>
<p>日志压缩的原理：存储引擎定期在日志中查找具有相同键的记录，丢掉所有重复的内容，并只保留每个键的最新更新。这个压缩与合并过程在后台运行。</p>
<ul>
<li>在日志结构存储引擎中，具有特殊值 NULL（<strong>墓碑</strong>，即 tombstone）的更新表示该键被删除，并会在日志压缩过程中被移除。</li>
<li>具有特殊值 NULL（<strong>墓碑</strong>，即 tombstone）的更新表示该键被删除，并会在日志压缩过程中被移除。</li>
<li>压缩日志所需的磁盘空间仅取决于数据库的当前内容，不取决于数据库中曾经发生的写入次数。</li>
</ul>
<p>如果 CDC 系统被配置为，每个变更都包含一个主键，且每个键的更新都替换了该键以前的值，那么只需要保留对键的最新写入就足够了。</p>
<p>无论何时需要重建衍生数据系统（如搜索索引），你可以从压缩日志主题的零偏移量处启动新的消费者，然后依次扫描日志中的所有消息。日志能保证包含数据库中每个键的最新值（也可能是一些较旧的值）—— 换句话说，你可以使用它来获取数据库内容的完整副本，而无需从 CDC 源数据库取一个快照。</p>
<p>Apache Kafka 支持这种日志压缩功能。允许消息代理被当成持久性存储使用，而不仅仅是用于临时消息。</p>
<h4 id="api">变更流的API支持</h4>
<p>越来越多的数据库开始将变更流作为第一等的接口。例如，RethinkDB 允许查询订阅通知，当查询结果变更时获得通知【36】，Firebase 【37】和 CouchDB 【38】基于变更流进行同步，该变更流同样可用于应用。而 Meteor 使用 MongoDB oplog 订阅数据变更，并改变了用户接口【39】。</p>
<p>VoltDB 允许事务以流的形式连续地从数据库中导出数据【40】</p>
<p>Kafka Connect【41】致力于将广泛的数据库系统的变更数据捕获工具与 Kafka 集成。</p>
<h3 id="_22">事件溯源</h3>
<p>与变更数据捕获类似，事件溯源涉及到 <strong>将所有对应用状态的变更</strong> 存储为变更事件日志。最大的区别是事件溯源将这一想法应用到了一个不同的抽象层次上：</p>
<ul>
<li>在变更数据捕获中，应用以 <strong>可变方式（mutable way）</strong> 使用数据库，可以任意更新和删除记录。写入数据库的应用不需要知道 CDC 的存在。</li>
<li>在事件溯源中，应用逻辑显式构建在写入事件日志的不可变事件之上。事件存储是仅追加写入的，更新与删除是不鼓励的或禁止的。事件被设计为旨在反映应用层面发生的事情，而不是底层的状态变更。</li>
</ul>
<p>事件溯源是一种强大的数据建模技术：从应用的角度来看，<strong>将用户的行为记录为不可变的事件更有意义</strong>，而不是在可变数据库中记录这些行为的影响。事件溯源使得应用随时间演化更为容易，通过更容易理解事情发生的原因来帮助调试的进行，并有利于防止应用 Bug。</p>
<p>事件溯源方法允许将新的副作用轻松地从现有事件中脱开。</p>
<ul>
<li>
<p>例如，存储 “学生取消选课” 事件以中性的方式清楚地表达了单个行为的意图，而其副作用 “从登记表中删除了一个条目，而一条取消原因的记录被添加到学生反馈表” 则嵌入了很多有关稍后对数据的使用方式的假设。</p>
</li>
<li>
<p>如果引入一个新的应用功能，例如 “将位置留给等待列表中的下一个人”，则达到解开的目的；</p>
</li>
</ul>
<p>事件溯源类似于 <strong>编年史（chronicle）</strong> 数据模型【45】，诸如 Event Store【46】这样的专业数据库已经被开发出来，供使用事件溯源的应用使用，这种方法独立于任何特定的工具。传统的数据库或基于日志的消息代理也可以用来构建这种风格的应用。</p>
<h4 id="_23">从事件日志中派生出当前状态</h4>
<p>事件日志本身并不是很有用，因为用户通常期望看到的是系统的当前状态，而不是变更历史。</p>
<p>用事件溯源的应用需要拉取事件日志（表示 <strong>写入</strong> 系统的数据），并将其转换为适合向用户显示的应用状态（从系统 <strong>读取</strong> 数据的方式【47】）。</p>
<ul>
<li>转换可以使用任意逻辑，但它应当是确定性的，以便能再次运行，并从事件日志中衍生出相同的应用状态。</li>
</ul>
<p>与变更数据捕获一样，重播事件日志允许让你重新构建系统的当前状态。不过，日志压缩需要采用不同的方式处理：</p>
<ul>
<li>用于记录更新的 CDC 事件通常包含记录的 <strong>完整新版本</strong>，因此主键的当前值完全由该主键的最近事件确定，而日志压缩可以丢弃相同主键的先前事件。</li>
<li>事件溯源在更高层次进行建模：事件通常表示用户操作的意图，而不是因为操作而发生的状态更新机制。后面的事件通常不会覆盖先前的事件，所以你需要完整的历史事件来重新构建最终状态。这里进行同样的日志压缩是不可能的。</li>
</ul>
<p>使用事件溯源的应用通常有一些机制，用于存储从事件日志中导出的当前状态快照，因此它们不需要重复处理完整的日志。</p>
<ul>
<li>这只是一种性能优化，用来加速读取，提高从崩溃中恢复的速度；</li>
<li>真正的目的是系统能够永久存储所有原始事件，并在需要时重新处理完整的事件日志。</li>
</ul>
<h4 id="_24">命令和事件</h4>
<p>事件溯源的哲学是仔细区分 <strong>事件（event）</strong> 和 <strong>命令（command）</strong>【48】。</p>
<ul>
<li>当来自用户的请求刚到达时它一开始是一个命令：在这个时间点上它仍然可能失败，比如，因为违反了一些完整性条件。</li>
<li>如果验证成功并且命令被接受，则它变为一个持久化且不可变的事件。</li>
</ul>
<p>在事件生成的时刻，它就成为了 <strong>事实（fact）</strong>。即使客户稍后决定更改或取消预订，他们之前曾预定了某个特定座位的事实仍然成立，而更改或取消是之后添加的单独的事件。</p>
<ul>
<li>例如，如果用户试图注册特定用户名，或预定飞机或剧院的座位，则应用需要检查用户名或座位是否已被占用。当检查成功时，应用可以生成一个事件，指示特定的用户名是由特定的用户 ID 注册的，或者座位已经预留给特定的顾客。</li>
</ul>
<p>事件流的消费者不允许拒绝事件：当消费者看到事件时，它已经成为日志中不可变的一部分，并且可能已经被其他消费者看到了。因此任何对命令的验证，都需要在它成为事件之前同步完成。</p>
<ul>
<li>或者，预订座位的用户请求可以拆分为两个事件：第一个是暂时预约，第二个是验证预约后的独立的确认事件 。这种分割方式允许验证发生在一个异步的过程中。</li>
</ul>
<h3 id="_25">状态、流和不变性</h3>
<p>不变性原则也是使得事件溯源与变更数据捕获如此强大的原因。</p>
<p>状态的本质是，它会变化，所以数据库才会支持数据的增删改。这又该如何匹配不变性呢？</p>
<ul>
<li>只要你的状态发生了变化，那么这个状态就是这段时间中事件修改的结果。</li>
</ul>
<p>无论状态如何变化，总是有一系列事件导致了这些变化。</p>
<ul>
<li>即使事情已经执行与回滚，这些事件出现是始终成立的。</li>
</ul>
<p>可变的状态与不可变事件的仅追加日志相互之间并不矛盾：它们是一体两面，互为阴阳的。所有变化的日志 —— <strong>变化日志（changelog）</strong>，表示了随时间演变的状态。</p>
<p>如果你倾向于数学表示，那么你可能会说，应用状态是事件流对时间求积分得到的结果，而变更流是状态对时间求微分的结果，如 图 11-6 所示【49,50,51】。</p>
<ul>
<li>这个比喻有一些局限性（例如，状态的二阶导似乎没有意义），但这是考虑数据的一个实用出发点。</li>
</ul>
<p><img alt="img" src="pics/fig11-6.png" /></p>
<center><b>图 11-6 应用当前状态与事件流之间的关系</b></center>

<p>正如帕特・赫兰（Pat Helland）所说的【52】：</p>
<blockquote>
<p>事务日志记录了数据库的所有变更。高速追加是更改日志的唯一方法。从这个角度来看，数据库的内容其实是日志中记录最新值的缓存。日志才是真相，数据库是日志子集的缓存，这一缓存子集恰好来自日志中每条记录与索引值的最新值。</p>
</blockquote>
<p>日志压缩是连接日志与数据库状态之间的桥梁：它只保留每条记录的最新版本，并丢弃被覆盖的版本。</p>
<h4 id="_26">不可变事件的优点</h4>
<p>数据库中的不变性是一个古老的概念。例如，会计在几个世纪以来一直在财务记账中应用不变性。</p>
<ul>
<li>一笔交易发生时，它被记录在一个仅追加写入的分类帐中，实质上是描述货币、商品或服务转手的事件日志。</li>
<li>账目，比如利润、亏损、资产负债表，是从分类账中的交易求和衍生而来【53】。</li>
</ul>
<p>如果发生错误，会计师不会删除或更改分类帐中的错误交易 —— 而是添加另一笔交易以补偿错误，例如退还一笔不正确的费用。</p>
<ul>
<li>不正确的交易将永远保留在分类帐中，对于审计而言可能非常重要。</li>
<li>如果从不正确的分类账衍生出的错误数字已经公布，那么下一个会计周期的数字就会包括一个更正。这个过程在会计事务中是很常见的【54】。</li>
</ul>
<p>不可变的事件也包含了比当前状态更多的信息。例如在购物网站上，顾客可以将物品添加到他们的购物车，然后再将其移除。虽然从履行订单的角度，第二个事件取消了第一个事件，但对分析目的而言，知道客户考虑过某个特定项而之后又反悔，可能是很有用的。也许他们会选择在未来购买，或者他们已经找到了替代品。这个信息被记录在事件日志中，但对于移出购物车就删除记录的数据库而言，这个信息在移出购物车时可能就丢失了【42】。</p>
<h4 id="_27">从同一事件日志中派生多个视图</h4>
<p>通过从不变的事件日志中分离出可变的状态，你可以针对不同的读取方式，从相同的事件日志中衍生出几种不同的表现形式。效果就像一个流的多个消费者一样（<a href="pics/fig11-5.png">图11-5</a>）：</p>
<ul>
<li>分析型数据库 Druid 使用这种方式直接从 Kafka 摄取数据【55】，Pistachio 是一个分布式的键值存储，使用 Kafka 作为提交日志【56】，Kafka Connect 能将来自 Kafka 的数据导出到各种不同的数据库与索引【41】。</li>
</ul>
<p>添加从事件日志到数据库的显式转换，能够使应用更容易地随时间演进：如果你想要引入一个新功能，以新的方式表示现有数据，则可以使用事件日志来构建一个单独的、针对新功能的读取优化视图，无需修改现有系统而与之共存。</p>
<ul>
<li>并行运行新旧系统通常比在现有系统中执行复杂的模式迁移更容易。一旦不再需要旧的系统，你可以简单地关闭它并回收其资源【47,57】。</li>
</ul>
<p>模式设计、索引和存储引擎的许多复杂性，都是希望支持某些特定查询和访问模式的结果。通过将数据写入的形式与读取形式相分离，并允许几个不同的读取视图，你能获得很大的灵活性。这个想法有时被称为 <strong>命令查询责任分离（command query responsibility segregation, CQRS）</strong>【42,58,59】。</p>
<p>数据库和模式设计的传统方法是基于这样一种谬论，数据必须以与查询相同的形式写入。</p>
<ul>
<li>如果可以将数据从<strong>针对写入优化的事件日志转换为针对读取优化的应用状</strong>态，那么有关规范化和非规范化的争论就变得无关紧要了。</li>
<li>在<strong>针对读取优化的视图中对数据进行非规范化是完全合理</strong>的，因为翻译过程提供了使其与事件日志保持一致的机制。</li>
</ul>
<h4 id="_28">并发控制</h4>
<p>事件溯源和变更数据捕获的最大缺点是，事件日志的消费者通常是异步的：用户会写入日志，然后从日志衍生视图中读取，结果发现他的写入还没有反映在读取视图中。</p>
<ul>
<li>一种解决方案是将<strong>事件追加到日志时同步执行读取视图的更新</strong>；将这些写入操作合并为一个原子单元需要 <strong>事务</strong>，所以要么将事件日志和读取视图保存在同一个存储系统中，要么就需要跨不同系统进行分布式事务。</li>
</ul>
<p>从事件日志导出当前状态也简化了并发控制的某些部分。</p>
<ul>
<li>对于多对象事务的需求，源于单个用户操作需要在多个不同的位置更改数据。通过事件溯源，你可以设计一个自包含的事件以表示一个用户操作。然后用户操作就只需要在一个地方进行单次写入操作 —— 即将事件附加到日志中 —— 这个还是很容易使原子化的。</li>
</ul>
<p>如果事件日志与应用状态以相同的方式分区（例如，处理分区 3 中的客户事件只需要更新分区 3 中的应用状态），那么直接使用单线程日志消费者就不需要写入并发控制了。它从设计上一次只处理一个事件。</p>
<p>。日志通过在分区中定义事件的序列顺序，消除了并发性的不确定性【24】。如果一个事件触及多个状态分区，那么需要做更多的工作，我们将在 <a href="12_the_future.html">第十二章</a> 讨论。</p>
<h4 id="_29">不变性的局限性</h4>
<p>许多不使用事件溯源模型的系统也还是依赖不可变性：各种数据库在内部使用不可变的数据结构或多版本数据来支持时间点快照。Git、Mercurial 和 Fossil 等版本控制系统也依靠不可变的数据来保存文件的版本历史记录。</p>
<p>永远保持所有变更的不变历史，在多大程度上是可行的？答案取决于数据集的流失率。</p>
<ul>
<li>一些工作负载主要是添加数据，很少更新或删除；它们很容易保持不变。其他工作负载在相对较小的数据集上有较高的更新 / 删除率；在这些情况下，不可变的历史可能增至难以接受的巨大，碎片化可能成为一个问题，压缩与垃圾收集的表现对于运维的稳健性变得至关重要【60,61】。</li>
</ul>
<p>除了性能方面的原因外，也可能有出于管理方面的原因需要删除数据的情况，尽管这些数据都是不可变的。</p>
<ul>
<li>例如，隐私条例可能要求在用户关闭帐户后删除他们的个人信息，数据保护立法可能要求删除错误的信息，或者可能需要阻止敏感信息的意外泄露。</li>
</ul>
<p>在这种情况下，仅仅在日志中添加另一个事件来指明先前的数据应该被视为删除是不够的：</p>
<ul>
<li>实际上是想改写历史，并假装数据从一开始就没有写入。例如，Datomic 管这个特性叫 <strong>切除（excision）</strong> 【62】，而 Fossil 版本控制系统有一个类似的概念叫 <strong>避免（shunning）</strong> 【63】。</li>
</ul>
<p>真正删除数据是非常非常困难的【64】，因为副本可能存在于很多地方：例如，存储引擎，文件系统和 SSD 通常会向一个新位置写入，而不是原地覆盖旧数据【52】，而备份通常是特意做成不可变的，防止意外删除或损坏。</p>
<ul>
<li>删除操作更多的是指 “使取回数据更困难”，而不是指 “使取回数据不可能”。无论如何，有时你必须得尝试。</li>
</ul>
<h2 id="_30">流处理</h2>
<p>可以用流做什么。一般来说，有三种选项：</p>
<ul>
<li>将事件中的数据写入数据库、缓存、搜索索引或类似的存储系统，然后能被其他客户端查询。如<a href="pics/fig11-5.png">图11-5</a>所示，这是数据库与系统其他部分所发生的变更保持同步的好方法</li>
<li>以某种方式将事件推送给用户，例如发送报警邮件或推送通知，或将事件流式传输到可实时显示的仪表板上。在这种情况下，人是流的最终消费者。</li>
<li>处理一个或多个输入流，并产生一个或多个输出流。流可能会经过由几个这样的处理阶段组成的流水线，最后再输出（选项 1 或 2）。</li>
</ul>
<p>在本章的剩余部分中，我们将讨论选项 3：处理流以产生其他衍生流。</p>
<ul>
<li>处理这样的流的代码片段，被称为 <strong>算子（operator）</strong> 或 <strong>作业（job）</strong>。</li>
<li>一个流处理器以只读的方式使用输入流，并将其输出以仅追加的方式写入一个不同的位置。</li>
</ul>
<p>流处理中的分区和并行化模式也非常类似于 <a href="10_batch_processing.html">第十章</a> 中介绍的 MapReduce 和数据流引擎，因此我们不再重复这些主题。基本的 Map 操作（如转换和过滤记录）也是一样的。</p>
<ul>
<li>与批量作业相比的一个关键区别是，流不会结束。因此无法使用 <strong>排序合并连接</strong>。</li>
<li>容错机制也必须改变：对于已经运行了几分钟的批处理作业，可以简单地从头开始重启失败任务，但是对于已经运行数年的流作业，重启后从头开始跑可能并不是一个可行的选项。</li>
</ul>
<h3 id="_31">流处理的应用</h3>
<p>长期以来，流处理一直用于监控目的，如果某个事件发生，组织希望能得到警报。例如：</p>
<ul>
<li>欺诈检测系统需要确定信用卡的使用模式是否有意外地变化，如果信用卡可能已被盗刷，则锁卡。</li>
<li>交易系统需要检查金融市场的价格变化，并根据指定的规则进行交易。</li>
<li>制造系统需要监控工厂中机器的状态，如果出现故障，可以快速定位问题。</li>
<li>军事和情报系统需要跟踪潜在侵略者的活动，并在出现袭击征兆时发出警报。</li>
</ul>
<p>这些类型的应用需要非常精密复杂的模式匹配与相关检测。然而随着时代的进步，流处理的其他用途也开始出现。</p>
<h4 id="_32">复合事件处理</h4>
<p><strong>复合事件处理（complex event processing, CEP）</strong> 是 20 世纪 90 年代为分析事件流而开发出的一种方法，尤其适用于需要搜索某些事件模式的应用【65,66】。CEP 允许你指定规则以在流中搜索某些事件模式。</p>
<p>CEP 系统通常使用高层次的声明式查询语言，比如 SQL，或者图形用户界面，来描述应该检测到的事件模式。这些查询被提交给处理引擎，该引擎消费输入流，并在内部维护一个执行所需匹配的状态机。当发现匹配时，引擎发出一个 <strong>复合事件</strong>（即 complex event，CEP 因此得名），并附有检测到的事件模式详情【67】。</p>
<p>在这些系统中，查询和数据之间的关系与普通数据库相比是颠倒的。</p>
<ul>
<li>通常情况下，数据库会持久存储数据，并将查询视为临时的：当查询进入时，数据库搜索与查询匹配的数据，然后在查询完成时丢掉查询。</li>
<li>CEP 引擎反转了角色：查询是长期存储的，来自输入流的事件不断流过它们，搜索匹配事件模式的查询【68】。</li>
</ul>
<p>CEP 的实现包括 Esper【69】、IBM InfoSphere Streams【70】、Apama、TIBCO StreamBase 和 SQLstream。像 Samza 这样的分布式流处理组件，支持使用 SQL 在流上进行声明式查询【71】。</p>
<h4 id="_33">流分析</h4>
<p>CEP 与流分析之间的边界是模糊的，但一般来说，分析往往对找出特定事件序列并不关心，而更关注大量事件上的聚合与统计指标 —— 例如：</p>
<ul>
<li>测量某种类型事件的速率（每个时间间隔内发生的频率）</li>
<li>滚动计算一段时间窗口内某个值的平均值</li>
<li>将当前的统计值与先前的时间区间的值对比（例如，检测趋势，当指标与上周同比异常偏高或偏低时报警）</li>
</ul>
<p>这些统计值通常是在固定时间区间内进行计算的，例如，你可能想知道在过去 5 分钟内服务每秒查询次数的均值，以及此时间段内响应时间的第 99 百分位点。</p>
<ul>
<li>在几分钟内取平均，能抹平秒和秒之间的无关波动，且仍然能向你展示流量模式的时间图景。聚合的时间间隔称为 <strong>窗口（window）</strong></li>
</ul>
<p>流分析系统有时会使用概率算法，例如 Bloom filter来管理成员资格，HyperLogLog【72】用于基数估计以及各种百分比估计算法。概率算法产出近似的结果，但比起精确算法的优点是内存使用要少得多。使用近似算法有时让人们觉得流处理系统总是有损的和不精确的，但这是错误看法：流处理并没有任何内在的近似性，而概率算法只是一种优化【73】。</p>
<p>许多开源分布式流处理框架的设计都是针对分析设计的：例如 Apache Storm、Spark Streaming、Flink、Concord、Samza 和 Kafka Streams 【74】。托管服务包括 Google Cloud Dataflow 和 Azure Stream Analytics。</p>
<h4 id="_34">维护物化视图</h4>
<p>数据库的变更流可以用于维护衍生数据系统（如缓存、搜索索引和数据仓库），并使其与源数据库保持最新。我们可以将这些示例视作维护 <strong>物化视图（materialized view）</strong> 的一种具体场景：在某个数据集上衍生出一个替代视图以便高效查询，并在底层数据变更时更新视图【50】。</p>
<p>同样，在事件溯源中，应用程序的状态是通过应用事件日志来维护的；这里的应用程序状态也是一种物化视图。与流分析场景不同的是，仅考虑某个时间窗口内的事件通常是不够的：构建物化视图可能需要任意时间段内的 <strong>所有</strong> 事件，除了那些可能由日志压缩丢弃的过时事件。实际上，你需要一个可以一直延伸到时间开端的窗口。</p>
<p>原则上讲，任何流处理组件都可以用于维护物化视图，尽管 “永远运行” 与一些面向分析的框架假设的 “主要在有限时间段窗口上运行” 背道而驰，Samza 和 Kafka Streams 支持这种用法，建立在 Kafka 对日志压缩的支持上【75】。</p>
<h4 id="_35">在流上搜索</h4>
<p>除了允许搜索由多个事件构成模式的 CEP 外，有时也存在基于复杂标准（例如全文搜索查询）来搜索单个事件的需求。</p>
<p>例如，媒体监测服务可以订阅新闻文章 Feed 与来自媒体的播客，搜索任何关于公司、产品或感兴趣的话题的新闻。</p>
<ul>
<li>通过预先构建一个搜索查询来完成的，然后不断地将新闻项的流与该查询进行匹配。</li>
</ul>
<p>Elasticsearch 的这种过滤器功能，是实现这种流搜索的一种选择【76】。</p>
<p>传统的搜索引擎首先索引文件，然后在索引上跑查询。相比之下，搜索一个数据流则反了过来：查询被存储下来，文档从查询中流过，就像在 CEP 中一样。</p>
<ul>
<li>最简单的情况就是，你可以为每个文档测试每个查询。但是如果你有大量查询，这可能会变慢。为了优化这个过程，可以像对文档一样，为查询建立索引。因而收窄可能匹配的查询集合【77】。</li>
</ul>
<h4 id="rpc">消息传递和RPC</h4>
<p>消息传递系统可以作为 RPC 的替代方案，即作为一种服务间通信的机制，比如在 Actor 模型中所使用的那样。尽管这些系统也是基于消息和事件，但我们通常不会将其视作流处理组件：</p>
<ul>
<li>Actor 框架主要是管理模块通信的并发和分布式执行的一种机制，而流处理主要是一种数据管理技术。</li>
<li>Actor 之间的交流往往是短暂的、一对一的；而事件日志则是持久的、多订阅者的。</li>
<li>Actor 可以以任意方式进行通信（包括循环的请求 / 响应模式），但流处理通常配置在无环流水线中，其中每个流都是一个特定作业的输出，由良好定义的输入流中派生而来。</li>
</ul>
<p>也就是说，RPC 类系统与流处理之间有一些交叉领域。例如，Apache Storm 有一个称为 <strong>分布式 RPC</strong> 的功能，它允许将用户查询分散到一系列也处理事件流的节点上；然后这些查询与来自输入流的事件交织，而结果可以被汇总并发回给用户【78】。</p>
<p>也可以使用 Actor 框架来处理流。但是，很多这样的框架在崩溃时不能保证消息的传递，除非你实现了额外的重试逻辑，否则这种处理不是容错的。</p>
<h3 id="_36">时间推理</h3>
<p>流处理通常需要与时间打交道，尤其是用于分析目的时候，会频繁使用时间窗口，例如 “过去五分钟的平均值”。</p>
<ul>
<li>读取运行批处理机器的系统时钟没有任何意义，因为处理运行的时间与事件实际发生的时间无关。</li>
</ul>
<p>使用事件中的时间戳，使得处理是 <strong>确定性</strong> 的：在相同的输入上再次运行相同的处理过程会得到相同的结果。</p>
<p>许多流处理框架使用处理机器上的本地系统时钟（<strong>处理时间</strong>，即 processing time）来确定 <strong>窗口（windowing）</strong>【79】。</p>
<ul>
<li>简单，如果事件创建与事件处理之间的延迟可以忽略不计，那也是合理；</li>
<li>如果存在任何显著的处理延迟 —— 即，事件处理显著地晚于事件实际发生的时间，这种处理方式就失效。</li>
</ul>
<h4 id="_37">事件时间与处理时间</h4>
<p>很多原因都可能导致处理延迟：排队，网络故障，性能问题导致消息代理 / 消息处理器出现争用，流消费者重启，从故障中恢复时重新处理过去的事件，或者在修复代码 BUG 之后。</p>
<p>而且，消息延迟还可能导致无法预测消息顺序。例如，假设用户首先发出一个 Web 请求（由 Web 服务器 A 处理），然后发出第二个请求（由服务器 B 处理）。A 和 B 发出描述它们所处理请求的事件，但是 B 的事件在 A 的事件发生之前到达消息代理。现在，流处理器将首先看到 B 事件，然后看到 A 事件，即使它们实际上是以相反的顺序发生的。</p>
<p>将事件时间和处理时间搞混会导致错误的数据。例如，假设你有一个流处理器用于测量请求速率（计算每秒请求数）。如果你重新部署流处理器，它可能会停止一分钟，并在恢复之后处理积压的事件。如果你按处理时间来衡量速率，那么在处理积压日志时，请求速率看上去就像有一个异常的突发尖峰，而实际上请求速率是稳定的。</p>
<p><img alt="img" src="pics/fig11-7.png" /></p>
<center><b>图 11-7 按处理时间分窗，会因为处理速率的变动引入人为因素</b></center>

<h4 id="_38">知道什么时候准备好了</h4>
<p>永远也无法确定是不是已经收到了特定窗口的所有事件，还是说还有一些事件正在来的路上。</p>
<ul>
<li>例如，假设你将事件分组为一分钟的窗口，以便统计每分钟的请求数。</li>
</ul>
<p>在一段时间没有看到任何新的事件之后，你可以超时并宣布一个窗口已经就绪，但仍然可能发生这种情况：某些事件被缓冲在另一台机器上，由于网络中断而延迟。需要能够处理这种在窗口宣告完成之后到达的 <strong>滞留（straggler）</strong> 事件。大体上，你有两种选择【1】：</p>
<ul>
<li>忽略这些滞留事件，因为在正常情况下它们可能只是事件中的一小部分。</li>
<li>发布一个 <strong>更正（correction）</strong>，一个包括滞留事件的更新窗口值。你可能还需要收回以前的输出。</li>
</ul>
<p>在某些情况下，可以使用特殊的消息来指示 “从现在开始，不会有比 t 更早时间戳的消息了”，消费者可以使用它来触发窗口【81】。但是，如果不同机器上的多个生产者都在生成事件，每个生产者都有自己的最小时间戳阈值，则消费者需要分别跟踪每个生产者。在这种情况下，添加和删除生产者都是比较棘手的。</p>
<h4 id="_39">你用的是谁的时钟？</h4>
<p>当事件可能在系统内多个地方进行缓冲时，为事件分配时间戳更加困难。</p>
<ul>
<li>例如，考虑一个移动应用向服务器上报关于用量的事件。该应用可能会在设备处于脱机状态时被使用</li>
<li>它将在设备本地缓冲事件，并在下一次互联网连接可用时向服务器上报这些事件（可能是几小时甚至几天）。对于这个流的任意消费者而言，它们就如延迟极大的滞留事件一样。</li>
</ul>
<p>在这种情况下，事件上的事件戳实际上应当是用户交互发生的时间，取决于移动设备的本地时钟。</p>
<ul>
<li><strong>用户控制的设备上的时钟通常是不可信</strong>的，因为它可能会被无意或故意设置成错误的时间。</li>
<li>服务器收到事件的时间（取决于服务器的时钟）可能是更准确的，因为服务器在你的控制之下，但在描述用户交互方面意义不大。</li>
</ul>
<p>要<strong>校正不正确的设备时钟</strong>，一种方法是记录三个时间戳【82】：</p>
<ul>
<li>事件发生的时间，取决于设备时钟</li>
<li>事件发送往服务器的时间，取决于设备时钟</li>
<li>事件被服务器接收的时间，取决于服务器时钟</li>
</ul>
<p>通过从第三个时间戳中减去第二个时间戳，可以估算设备时钟和服务器时钟之间的偏移（假设网络延迟与所需的时间戳精度相比可忽略不计）。然后可以将该偏移应用于事件时间戳，从而估计事件实际发生的真实时间（假设设备时钟偏移在事件发生时与送往服务器之间没有变化）。</p>
<p>这并不是流处理独有的问题，批处理有着完全一样的时间推理问题。只是在流处理的上下文中，我们更容易意识到时间的流逝。</p>
<h4 id="_40">窗口的类型</h4>
<p>当你知道如何确定一个事件的时间戳后，下一步就是如何定义时间段的窗口。有几种窗口很常用【79,83】：</p>
<ul>
<li>滚动窗口（Tumbling Window）：滚动窗口有着固定的长度，每个事件都仅能属于一个窗口。</li>
<li>假设 1 分钟的滚动窗口，则所有时间戳在 <code>10:03:00</code> 和 <code>10:03:59</code> 之间的事件会被分组到一个窗口中</li>
<li><code>10:04:00</code> 和 <code>10:04:59</code> 之间的事件被分组到下一个窗口，依此类推</li>
<li>通过将每个事件时间戳四舍五入至最近的分钟来确定它所属的窗口，可以实现 1 分钟的滚动窗口。</li>
<li>跳动窗口（Hopping Window）：固定的长度，但允许窗口重叠以提供一些平滑。</li>
<li>一个带有 1 分钟跳跃步长的 5 分钟窗口将包含 <code>10:03:00</code> 至 <code>10:07:59</code> 之间的事件，而下一个窗口将覆盖 <code>10:04:00</code> 至 <code>10:08:59</code> 之间的事件，等等。</li>
<li>通过首先计算 1 分钟的滚动窗口（tunmbling window），然后在几个相邻窗口上进行聚合，可以实现这种跳动窗口。</li>
<li>滑动窗口（Sliding Window）：彼此间距在特定时长内的所有事件</li>
<li>一个 5 分钟的滑动窗口应当覆盖 <code>10:03:39</code> 和 <code>10:08:12</code> 的事件，因为它们相距不超过 5 分钟</li>
<li>滚动窗口与步长 5 分钟的跳动窗口可能不会把这两个事件分组到同一个窗口中，因为它们使用固定的边界</li>
<li>通过维护一个按时间排序的事件缓冲区，并不断从窗口中移除过期的旧事件，可以实现滑动窗口。</li>
<li>会话窗口（Session window）：与其他窗口类型不同，会话窗口没有固定的持续时间</li>
<li>将同一用户出现时间相近的所有事件分组在一起，而当用户一段时间没有活动时（例如，如果 30 分钟内没有事件）窗口结束。</li>
</ul>
<h3 id="_41">流连接</h3>
<p>由于流处理将数据管道泛化为对无限数据集进行增量处理，因此对流进行连接的需求也是完全相同的。先来区分三种不同类型的连接：<strong>流 - 流</strong> 连接，<strong>流 - 表</strong> 连接，与 <strong>表 - 表</strong> 连接【84】。</p>
<h4 id="_42">流流连接（窗口连接）</h4>
<p>假设你的网站上有搜索功能，而你想要找出搜索 URL 的近期趋势。每当有人键入搜索查询时，都会记录下一个包含查询与其返回结果的事件。每当有人点击其中一个搜索结果时，就会记录另一个记录点击事件。为了计算搜索结果中每个 URL 的点击率，你需要将搜索动作与点击动作的事件连在一起，这些事件通过相同的会话 ID 进行连接。广告系统中需要类似的分析【85】。</p>
<ul>
<li>搜索与点击之间的时间可能是高度可变：在很多情况下，它可能是几秒钟，但也可能长达几天或几周；</li>
<li>由于可变的网络延迟，点击事件甚至可能先于搜索事件到达；</li>
<li>选择合适的连接窗口 —— 例如，如果点击与搜索之间的时间间隔在一小时内，你可能会选择连接两者。</li>
</ul>
<p>在点击事件中嵌入搜索详情与事件连接并不一样：这样做的话，只有当用户点击了一个搜索结果时你才能知道，而那些没有点击的搜索就无能为力了。为了衡量搜索质量，你需要准确的点击率，为此搜索事件和点击事件两者都是必要的。</p>
<p>为了实现这种类型的连接，流处理器需要维护 <strong>状态</strong>：</p>
<ul>
<li>例如，按会话 ID 索引最近一小时内发生的所有事件。无论何时发生搜索事件或点击事件，都会被添加到合适的索引中，而流处理器也会检查另一个索引是否有具有相同会话 ID 的事件到达。</li>
<li>如果有匹配事件就会发出一个表示搜索结果被点击的事件；如果搜索事件直到过期都没看见有匹配的点击事件，就会发出一个表示搜索结果未被点击的事件。</li>
</ul>
<h4 id="_43">流表连接（流扩充）</h4>
<p>连接两个数据集的批处理作业示例：一组用户活动事件和一个用户档案数据库。将用户活动事件视为流，并在流处理器中连续执行相同的连接是很自然的想法：输入是包含用户 ID 的活动事件流，而输出还是活动事件流，但其中用户 ID 已经被扩展为用户的档案信息。这个过程有时被称为使用数据库的信息来 <strong>扩充（enriching）</strong> 活动事件。</p>
<p>要执行此连接，流处理器需要一次处理一个活动事件，在数据库中查找事件的用户 ID，并将档案信息添加到活动事件中。</p>
<ul>
<li>数据库查询可以通过查询远程数据库来实现，此类远程查询可能会很慢，并且有可能导致数据库过载【75】。</li>
<li>将数据库副本加载到流处理器中，以便在本地进行查询而无需网络往返。如果数据库的本地副本足够小，则可以是内存中的散列表，比较大的话也可以是本地磁盘上的索引。</li>
</ul>
<p>流处理器是长时间运行的，且数据库的内容可能随时间而改变，所以<strong>流处理器数据库的本地副本需要保持更新</strong>。</p>
<ul>
<li>通过变更数据捕获来解决：流处理器可以订阅用户档案数据库的更新日志，如同活动事件流一样。当增添或修改档案时，流处理器会更新其本地副本。</li>
</ul>
<p>流表连接实际上非常类似于流流连接；最大的区别在于对于表的变更日志流，连接使用了一个可以回溯到 “时间起点” 的窗口（概念上是无限的窗口），新版本的记录会覆盖更早的版本。对于输入的流，连接可能压根儿就没有维护任何窗口。</p>
<h4 id="_44">表表连接（维护物化视图）</h4>
<p>推特时间线例子：当用户想要查看他们的主页时间线时，迭代用户所关注人群的推文并合并它们是一个开销巨大的操作。</p>
<ul>
<li>需要一个时间线缓存：一种每个用户的 “收件箱”，在发送推文的时候写入这些信息，因而读取时间线时只需要简单地查询即可。</li>
</ul>
<p>物化与维护这个缓存需要处理以下事件：</p>
<ul>
<li>当用户 u 发送新的推文时，它将被添加到每个关注用户 u 的时间线上。</li>
<li>用户删除推文时，推文将从所有用户的时间表中删除。</li>
<li>当用户 u1 开始关注用户 u2 时，<span class="arithmatex">\(u_2\)</span> 最近的推文将被添加到 u1 的时间线上。</li>
<li>当用户 u1 取消关注用户 u2 时，<span class="arithmatex">\(u_2\)</span> 的推文将从 u1 的时间线中移除。</li>
</ul>
<p>要在流处理器中实现这种缓存维护，你需要推文事件流（发送与删除）和关注关系事件流（关注与取消关注）。流处理需要维护一个数据库，包含每个用户的粉丝集合。以便知道当一条新推文到达时，需要更新哪些时间线【86】。</p>
<p>观察这个流处理过程的另一种视角是：它维护了一个连接了两个表（推文与关注）的物化视图，如下所示：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">follows</span><span class="p">.</span><span class="n">follower_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">timeline_id</span><span class="p">,</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="n">array_agg</span><span class="p">(</span><span class="n">tweets</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">tweets</span><span class="p">.</span><span class="k">timestamp</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">tweets</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="k">JOIN</span><span class="w"> </span><span class="n">follows</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">follows</span><span class="p">.</span><span class="n">followee_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tweets</span><span class="p">.</span><span class="n">sender_id</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">follows</span><span class="p">.</span><span class="n">follower_id</span>
</code></pre></div>
<p>流连接直接对应于这个查询中的表连接。时间线实际上是这个查询结果的缓存，每当底层的表发生变化时都会更新 <sup id="fnref:3"><a class="footnote-ref" href="#fn:3">2</a></sup>。</p>
<h4 id="_45">连接的时间依赖性</h4>
<p>这里描述的三种连接（流流，流表，表表）有很多共通之处：它们都需要流处理器维护连接一侧的一些状态（搜索与点击事件，用户档案，关注列表），然后当连接另一侧的消息到达时查询该状态。</p>
<p>用于维护状态的事件顺序是很重要的（先关注然后取消关注，或者其他类似操作）。在分区日志中，单个分区内的事件顺序是保留下来的。但典型情况下是<strong>没有跨流或跨分区的顺序保证的</strong>。</p>
<p>如果不同流中的事件发生在近似的时间范围内，则应该按照什么样的顺序进行处理？</p>
<ul>
<li>在流表连接的例子中，如果用户更新了它们的档案，哪些活动事件与旧档案连接（在档案更新前处理），哪些又与新档案连接（在档案更新之后处理）？</li>
<li>需要对一些状态做连接，如果状态会随着时间推移而变化，那应当使用什么时间点来连接呢【45】？</li>
</ul>
<p>这种时序依赖可能出现在很多地方。例如销售东西需要对发票应用适当的税率，当连接销售额与税率表时，你可能期望的是使用销售时的税率参与连接。如果你正在重新处理历史数据，销售时的税率可能和现在的税率有所不同。</p>
<p>如果跨越流的事件顺序是未定的，则连接会变为不确定性的【87】，这意味着你在同样输入上重跑相同的作业未必会得到相同的结果：当你重跑任务时，输入流上的事件可能会以不同的方式交织。</p>
<p>在数据仓库中，这个问题被称为 <strong>缓慢变化的维度（slowly changing dimension, SCD）</strong>，通常通过对特定版本的记录使用唯一的标识符来解决：例如，每当税率改变时都会获得一个新的标识符，而发票在销售时会带有税率的标识符【88,89】。这种变化使连接变为确定性的，但也会导致日志压缩无法进行：表中所有的记录版本都需要保留。</p>
<h3 id="_46">容错</h3>
<p>批处理容错方法可确保批处理作业的输出与没有出错的情况相同，即使实际上某些任务失败了。尽管重启任务意味着实际上可能会多次处理记录，但输出中的可见效果看上去就像只处理过一次。这个原则被称为 <strong>恰好一次语义（exactly-once semantics）</strong>，尽管 <strong>等效一次（effectively-once）</strong> 可能会是一个更写实的术语【90】</p>
<p>在流处理中也出现了同样的容错问题，但是处理起来没有那么直观：<strong>等待某个任务完成之后再使其输出可见并不是一个可行选项</strong>，因为你永远无法处理完一个无限的流。</p>
<h4 id="_47">微批量与存档点</h4>
<p>一个解决方案是将流分解成小块，并像微型批处理一样处理每个块。这种方法被称为 <strong>微批次（microbatching）</strong>，它被用于 Spark Streaming 【91】。</p>
<ul>
<li>批次的大小通常约为 1 秒，这是对性能妥协的结果：较小的批次会导致更大的调度与协调开销，而较大的批次意味着流处理器结果可见之前的延迟要更长。</li>
<li>微批次也隐式提供了一个与批次大小相等的滚动窗口（按处理时间而不是事件时间戳分窗）。任何需要更大窗口的作业都需要显式地将状态从一个微批次转移到下一个微批次。</li>
</ul>
<p>Apache Flink 则使用不同的方法，它会定期生成状态的滚动存档点并将其写入持久存储【92,93】。</p>
<ul>
<li>如果流算子崩溃，它可以从最近的存档点重启，并丢弃从最近检查点到崩溃之间的所有输出。</li>
<li>存档点会由消息流中的 <strong>壁障（barrier）</strong> 触发，类似于微批次之间的边界，但不会强制一个特定的窗口大小。</li>
</ul>
<p>在流处理框架的范围内，微批次与存档点方法提供了与批处理一样的 <strong>恰好一次语义</strong>。但是，只要输出离开流处理器（例如，写入数据库，向外部消息代理发送消息，或发送电子邮件），框架就无法抛弃失败批次的输出了。在这种情况下，重启失败任务会导致外部副作用发生两次，只有微批次或存档点不足以阻止这一问题。</p>
<h4 id="_48">原子提交再现</h4>
<p>确保事件处理的所有输出和副作用 <strong>当且仅当</strong> 处理成功时才会生效。</p>
<ul>
<li>包括发送给下游算子或外部消息传递系统（包括电子邮件或推送通知）的任何消息，任何数据库写入，对算子状态的任何变更，以及对输入消息的任何确认（包括在基于日志的消息代理中将消费者偏移量前移）。</li>
</ul>
<p>这些事情要么都原子地发生，要么都不发生，但是它们不应当失去同步。在 <a href="9_consistency_consensus.html">第九章</a> 中，我们讨论了分布式事务传统实现中的问题（如 XA）。然而在限制更为严苛的环境中，也是有可能高效实现这种原子提交机制的。</p>
<ul>
<li>Google Cloud Dataflow【81,92】和 VoltDB 【94】中使用了这种方法，Apache Kafka 有计划加入类似的功能【95,96】。</li>
<li>与 XA 不同，这些实现不会尝试跨异构技术提供事务，而是通过在流处理框架中同时管理状态变更与消息传递来内化事务。事务协议的开销可以通过在单个事务中处理多个输入消息来分摊。</li>
</ul>
<h4 id="_49">幂等性</h4>
<p>我们的目标是丢弃任何失败任务的部分输出，以便能安全地重试，而不会生效两次。</p>
<ul>
<li>分布式事务是实现这个目标的一种方式，而另一种方式是依赖 <strong>幂等性（idempotence）</strong>【97】。幂等操作是一种实现 <strong>恰好一次语义</strong> 的有效方式，仅需很小的额外开销。</li>
</ul>
<p>幂等操作是多次重复执行与单次执行效果相同的操作。</p>
<ul>
<li>例如，将键值存储中的某个键设置为某个特定值是幂等的，而递增一个计数器不是幂等的。</li>
</ul>
<p>即使一个操作不是天生幂等的，往往可以通过一些额外的元数据做成幂等的。</p>
<ul>
<li>例如，在使用来自 Kafka 的消息时，每条消息都有一个持久的、单调递增的偏移量。将值写入外部数据库时可以将这个偏移量带上，这样你就可以判断一条更新是不是已经执行过了，因而避免重复执行。</li>
</ul>
<p>Storm 的 Trident 基于类似的想法来处理状态【78】。依赖幂等性意味着隐含了一些假设：重启一个失败的任务必须以相同的顺序重播相同的消息（基于日志的消息代理能做这些事），处理必须是确定性的，没有其他节点能同时更新相同的值【98,99】。</p>
<p>当从一个处理节点故障切换到另一个节点时，可能需要进行 <strong>防护</strong>（fencing），以防止被假死节点干扰。</p>
<h4 id="_50">失败后重建状态</h4>
<p>任何需要状态的流处理 —— 例如，任何窗口聚合（例如计数器，平均值和直方图）以及任何用于连接的表和索引，都必须确保在失败之后能恢复其状态。</p>
<ul>
<li>一种选择是将状态保存在远程数据存储中，并进行复制，每个消息都要查询远程数据库可能会很慢。</li>
<li>另一种方法是在流处理器本地保存状态，并定期复制。</li>
</ul>
<p>例如，Flink 定期捕获算子状态的快照，并将它们写入 HDFS 等持久存储中【92,93】。Samza 和 Kafka Streams 通过将状态变更发送到具有日志压缩功能的专用 Kafka 主题来复制状态变更，这与变更数据捕获类似【84,100】。VoltDB 通过在多个节点上对每个输入消息进行冗余处理来复制状态。</p>
<p>在某些情况下，甚至可能都不需要复制状态，因为它可以从输入流重建。</p>
<ul>
<li>例如，如果状态是从相当短的窗口中聚合而成，则简单地重播该窗口中的输入事件可能是足够快的。</li>
<li>如果状态是通过变更数据捕获来维护的数据库的本地副本，那么也可以从日志压缩的变更流中重建数据库。</li>
</ul>
<p>然而，所有这些权衡取决于底层基础架构的性能特征：在某些系统中，网络延迟可能低于磁盘访问延迟，网络带宽也可能与磁盘带宽相当。没有针对所有情况的普适理想权衡，随着存储和网络技术的发展，本地状态与远程状态的优点也可能会互换。</p>
<h2 id="_51">本章小结</h2>
<p>流处理在无限的（永无止境的）流而不是固定大小的输入上持续进行，从这个角度来看，消息代理和事件日志可以视作文件系统的流式等价物。</p>
<p>比较两种消息代理：</p>
<ul>
<li>AMQP/JMS 风格的消息代理：代理将单条消息分配给消费者，消费者在成功处理单条消息后确认消息。消息被确认后从代理中删除。</li>
<li>适合作为一种异步形式的 RPC，例如在任务队列中，消息处理的确切顺序并不重要，而且消息在处理完之后，不需要回头重新读取旧消息。</li>
<li>基于日志的消息代理：代理将一个分区中的所有消息分配给同一个消费者节点，并始终以相同的顺序传递消息。</li>
<li>并行是通过分区实现的，消费者通过存档最近处理消息的偏移量来跟踪工作进度。消息代理将消息保留在磁盘上，因此如有必要的话，可以回跳并重新读取旧消息。</li>
</ul>
<p>基于日志的方法与数据库中的复制日志和日志结构存储引擎有相似之处。我们看到，这种方法对于消费输入流，并产生衍生状态或衍生输出数据流的系统而言特别适用。</p>
<p>发现将数据库写入视作流也是很有用的：我们可以捕获变更日志 —— 即对数据库所做的所有变更的历史记录 —— 隐式地通过变更数据捕获，或显式地通过事件溯源。日志压缩允许流也能保有数据库内容的完整副本。</p>
<ul>
<li>通过消费变更日志并将其应用至衍生系统，你能使诸如搜索索引、缓存以及分析系统这类衍生数据系统不断保持更新。</li>
</ul>
<p>讨论了流处理的几种目的，包括搜索事件模式（复杂事件处理），计算分窗聚合（流分析），以及保证衍生数据系统处于最新状态（物化视图）。</p>
<p>讨论了在流处理中对时间进行推理的困难，包括处理时间与事件时间戳之间的区别，以及当你认为窗口已经完事之后，如何处理到达的掉队事件的问题。</p>
<p>区分了流处理中可能出现的三种连接类型：</p>
<ul>
<li>流流连接：两个输入流都由活动事件组成，而连接算子在某个时间窗口内搜索相关的事件。</li>
</ul>
<p>例如，它可能会将同一个用户 30 分钟内进行的两个活动联系在一起。如果你想要找出一个流内的相关事件，连接的两侧输入可能实际上都是同一个流（<strong>自连接</strong>，即 self-join）。</p>
<ul>
<li>流表连接：一个输入流由活动事件组成，另一个输入流是数据库变更日志。</li>
</ul>
<p>变更日志保证了数据库的本地副本是最新的。对于每个活动事件，连接算子将查询数据库，并输出一个扩展的活动事件。</p>
<ul>
<li>表表连接：两个输入流都是数据库变更日志。在这种情况下，一侧的每一个变化都与另一侧的最新状态相连接。结果是两表连接所得物化视图的变更流。</li>
</ul>
<p>最后，我们讨论了在流处理中实现容错和恰好一次语义的技术。由于流处理长时间运行并持续产生输出，所以不能简单地丢弃所有的输出。</p>
<ul>
<li>使用更细粒度的恢复机制，基于微批次、存档点、事务或幂等写入。</li>
</ul>
<h2 id="_52">参考文献</h2>
<ol>
<li>Tyler Akidau, Robert Bradshaw, Craig Chambers, et al.: “<a href="http://www.vldb.org/pvldb/vol8/p1792-Akidau.pdf">The Dataflow Model: A Practical Approach to Balancing Correctness, Latency, and Cost in Massive-Scale, Unbounded, Out-of-Order Data Processing</a>,” <em>Proceedings of the VLDB Endowment</em>, volume 8, number 12, pages 1792–1803, August 2015. <a href="http://dx.doi.org/10.14778/2824032.2824076">doi:10.14778/2824032.2824076</a></li>
<li>Harold Abelson, Gerald Jay Sussman, and Julie Sussman: <a href="https://mitpress.mit.edu/sicp/"><em>Structure and Interpretation of Computer Programs</em></a>, 2nd edition. MIT Press, 1996. ISBN: 978-0-262-51087-5, available online at <em>mitpress.mit.edu</em></li>
<li>Patrick Th. Eugster, Pascal A. Felber, Rachid Guerraoui, and Anne-Marie Kermarrec: “<a href="http://www.cs.ru.nl/~pieter/oss/manyfaces.pdf">The Many Faces of Publish/Subscribe</a>,” <em>ACM Computing Surveys</em>, volume 35, number 2, pages 114–131, June 2003. <a href="http://dx.doi.org/10.1145/857076.857078">doi:10.1145/857076.857078</a></li>
<li>Joseph M. Hellerstein and Michael Stonebraker: <a href="http://redbook.cs.berkeley.edu/"><em>Readings in Database Systems</em></a>, 4th edition. MIT Press, 2005. ISBN: 978-0-262-69314-1, available online at <em>redbook.cs.berkeley.edu</em></li>
<li>Don Carney, Uğur Çetintemel, Mitch Cherniack, et al.: “<a href="http://www.vldb.org/conf/2002/S07P02.pdf">Monitoring Streams – A New Class of Data Management Applications</a>,” at <em>28th International Conference on Very Large Data Bases</em> (VLDB), August 2002.</li>
<li>Matthew Sackman: “<a href="http://www.lshift.net/blog/2016/05/05/pushing-back/">Pushing Back</a>,” <em>lshift.net</em>, May 5, 2016.</li>
<li>Vicent Martí: “<a href="http://githubengineering.com/brubeck/">Brubeck, a statsd-Compatible Metrics Aggregator</a>,” <em>githubengineering.com</em>, June 15, 2015.</li>
<li>Seth Lowenberger: “<a href="http://www.nasdaqtrader.com/content/technicalsupport/specifications/dataproducts/moldudp64.pdf">MoldUDP64 Protocol Specification V 1.00</a>,” <em>nasdaqtrader.com</em>, July 2009.</li>
<li>Pieter Hintjens: <a href="http://zguide.zeromq.org/page:all"><em>ZeroMQ – The Guide</em></a>. O'Reilly Media, 2013. ISBN: 978-1-449-33404-8</li>
<li>Ian Malpass: “<a href="https://codeascraft.com/2011/02/15/measure-anything-measure-everything/">Measure Anything, Measure Everything</a>,” <em>codeascraft.com</em>, February 15, 2011.</li>
<li>Dieter Plaetinck: “<a href="https://blog.raintank.io/25-graphite-grafana-and-statsd-gotchas/">25 Graphite, Grafana and statsd Gotchas</a>,” <em>blog.raintank.io</em>, March 3, 2016.</li>
<li>Jeff Lindsay: “<a href="http://progrium.com/blog/2007/05/03/web-hooks-to-revolutionize-the-web/">Web Hooks to Revolutionize the Web</a>,” <em>progrium.com</em>, May 3, 2007.</li>
<li>Jim N. Gray: “<a href="http://research.microsoft.com/pubs/69641/tr-95-56.pdf">Queues Are Databases</a>,” Microsoft Research Technical Report MSR-TR-95-56, December 1995.</li>
<li>Mark Hapner, Rich Burridge, Rahul Sharma, et al.: “<a href="https://jcp.org/en/jsr/detail?id=343">JSR-343 Java Message Service (JMS) 2.0 Specification</a>,” <em>jms-spec.java.net</em>, March 2013.</li>
<li>Sanjay Aiyagari, Matthew Arrott, Mark Atwell, et al.: “<a href="http://www.rabbitmq.com/resources/specs/amqp0-9-1.pdf">AMQP: Advanced Message Queuing Protocol Specification</a>,” Version 0-9-1, November 2008.</li>
<li>“<a href="https://cloud.google.com/pubsub/architecture">Google Cloud Pub/Sub: A Google-Scale Messaging Service</a>,” <em>cloud.google.com</em>, 2016.</li>
<li>“<a href="http://kafka.apache.org/documentation.html">Apache Kafka 0.9 Documentation</a>,” <em>kafka.apache.org</em>, November 2015.</li>
<li>Jay Kreps, Neha Narkhede, and Jun Rao: “<a href="http://www.longyu23.com/doc/Kafka.pdf">Kafka: A Distributed Messaging System for Log Processing</a>,” at <em>6th International Workshop on Networking Meets Databases</em> (NetDB), June 2011.</li>
<li>“<a href="http://docs.aws.amazon.com/streams/latest/dev/introduction.html">Amazon Kinesis Streams Developer Guide</a>,” <em>docs.aws.amazon.com</em>, April 2016.</li>
<li>Leigh Stewart and Sijie Guo: “<a href="https://blog.twitter.com/2015/building-distributedlog-twitter-s-high-performance-replicated-log-service">Building DistributedLog: Twitter’s High-Performance Replicated Log Service</a>,” <em>blog.twitter.com</em>, September 16, 2015.</li>
<li>“<a href="http://distributedlog.incubator.apache.org/docs/latest/">DistributedLog Documentation</a>,” Twitter, Inc., <em>distributedlog.io</em>, May 2016.</li>
<li>Jay Kreps: “<a href="https://engineering.linkedin.com/kafka/benchmarking-apache-kafka-2-million-writes-second-three-cheap-machines">Benchmarking Apache Kafka: 2 Million Writes Per Second (On Three Cheap Machines)</a>,” <em>engineering.linkedin.com</em>, April 27, 2014.</li>
<li>Kartik Paramasivam: “<a href="https://engineering.linkedin.com/apache-kafka/how-we_re-improving-and-advancing-kafka-linkedin">How We’re Improving and Advancing Kafka at LinkedIn</a>,” <em>engineering.linkedin.com</em>, September 2, 2015.</li>
<li>Jay Kreps: “<a href="http://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying">The Log: What Every Software Engineer Should Know About Real-Time Data's Unifying Abstraction</a>,” <em>engineering.linkedin.com</em>, December 16, 2013.</li>
<li>Shirshanka Das, Chavdar Botev, Kapil Surlaker, et al.: “<a href="http://www.socc2012.org/s18-das.pdf">All Aboard the Databus!</a>,” at <em>3rd ACM Symposium on Cloud Computing</em> (SoCC), October 2012.</li>
<li>Yogeshwer Sharma, Philippe Ajoux, Petchean Ang, et al.: “<a href="https://www.usenix.org/system/files/conference/nsdi15/nsdi15-paper-sharma.pdf">Wormhole: Reliable Pub-Sub to Support Geo-Replicated Internet Services</a>,” at <em>12th USENIX Symposium on Networked Systems Design and Implementation</em> (NSDI), May 2015.</li>
<li>P. P. S. Narayan: “<a href="http://web.archive.org/web/20160801221400/https://developer.yahoo.com/blogs/ydn/sherpa-7992.html">Sherpa Update</a>,” <em>developer.yahoo.com</em>, June 8, .</li>
<li>Martin Kleppmann: “<a href="http://martin.kleppmann.com/2015/04/23/bottled-water-real-time-postgresql-kafka.html">Bottled Water: Real-Time Integration of PostgreSQL and Kafka</a>,” <em>martin.kleppmann.com</em>, April 23, 2015.</li>
<li>Ben Osheroff: “<a href="https://developer.zendesk.com/blog/introducing-maxwell-a-mysql-to-kafka-binlog-processor">Introducing Maxwell, a mysql-to-kafka Binlog Processor</a>,” <em>developer.zendesk.com</em>, August 20, 2015.</li>
<li>Randall Hauch: “<a href="http://debezium.io/blog/2016/06/10/Debezium-0/">Debezium 0.2.1 Released</a>,” <em>debezium.io</em>, June 10, 2016.</li>
<li>Prem Santosh Udaya Shankar: “<a href="https://engineeringblog.yelp.com/2016/08/streaming-mysql-tables-in-real-time-to-kafka.html">Streaming MySQL Tables in Real-Time to Kafka</a>,” <em>engineeringblog.yelp.com</em>, August 1, 2016.</li>
<li>“<a href="https://github.com/stripe/mongoriver">Mongoriver</a>,” Stripe, Inc., <em>github.com</em>, September 2014.</li>
<li>Dan Harvey: “<a href="http://www.slideshare.net/danharvey/change-data-capture-with-mongodb-and-kafka">Change Data Capture with Mongo + Kafka</a>,” at <em>Hadoop Users Group UK</em>, August 2015.</li>
<li>“<a href="http://www.oracle.com/us/products/middleware/data-integration/oracle-goldengate-realtime-access-2031152.pdf">Oracle GoldenGate 12c: Real-Time Access to Real-Time Information</a>,” Oracle White Paper, March 2015.</li>
<li>“<a href="https://www.youtube.com/watch?v=6H9NibIiPQE">Oracle GoldenGate Fundamentals: How Oracle GoldenGate Works</a>,” Oracle Corporation, <em>youtube.com</em>, November 2012.</li>
<li>Slava Akhmechet: “<a href="http://rethinkdb.com/blog/realtime-web/">Advancing the Realtime Web</a>,” <em>rethinkdb.com</em>, January 27, 2015.</li>
<li>“<a href="https://firebase.google.com/docs/database/">Firebase Realtime Database Documentation</a>,” Google, Inc., <em>firebase.google.com</em>, May 2016.</li>
<li>“<a href="http://docs.couchdb.org/en/latest/">Apache CouchDB 1.6 Documentation</a>,” <em>docs.couchdb.org</em>, 2014.</li>
<li>Matt DeBergalis: “<a href="http://info.meteor.com/blog/meteor-070-scalable-database-queries-using-mongodb-oplog-instead-of-poll-and-diff">Meteor 0.7.0: Scalable Database Queries Using MongoDB Oplog Instead of Poll-and-Diff</a>,” <em>info.meteor.com</em>, December 17, 2013.</li>
<li>“<a href="https://docs.voltdb.com/UsingVoltDB/ChapExport.php">Chapter 15. Importing and Exporting Live Data</a>,” VoltDB 6.4 User Manual, <em>docs.voltdb.com</em>, June 2016.</li>
<li>Neha Narkhede: “<a href="http://www.confluent.io/blog/announcing-kafka-connect-building-large-scale-low-latency-data-pipelines">Announcing Kafka Connect: Building Large-Scale Low-Latency Data Pipelines</a>,” <em>confluent.io</em>, February 18, 2016.</li>
<li>Greg Young: “<a href="https://www.youtube.com/watch?v=JHGkaShoyNs">CQRS and Event Sourcing</a>,” at <em>Code on the Beach</em>, August 2014.</li>
<li>Martin Fowler: “<a href="http://martinfowler.com/eaaDev/EventSourcing.html">Event Sourcing</a>,” <em>martinfowler.com</em>, December 12, 2005.</li>
<li>Vaughn Vernon: <a href="https://vaughnvernon.co/?page_id=168"><em>Implementing Domain-Driven Design</em></a>. Addison-Wesley Professional, 2013. ISBN: 978-0-321-83457-7</li>
<li>H. V. Jagadish, Inderpal Singh Mumick, and Abraham Silberschatz: “<a href="http://www.mathcs.emory.edu/~cheung/papers/StreamDB/Histogram/1995-Jagadish-Histo.pdf">View Maintenance Issues for the Chronicle Data Model</a>,” at <em>14th ACM SIGACT-SIGMOD-SIGART Symposium on Principles of Database Systems</em> (PODS), May 1995. <a href="http://dx.doi.org/10.1145/212433.220201">doi:10.1145/212433.220201</a></li>
<li>“<a href="http://docs.geteventstore.com/">Event Store 3.5.0 Documentation</a>,” Event Store LLP, <em>docs.geteventstore.com</em>, February 2016.</li>
<li>Martin Kleppmann: <a href="http://www.oreilly.com/data/free/stream-processing.csp"><em>Making Sense of Stream Processing</em></a>. Report, O'Reilly Media, May 2016.</li>
<li>Sander Mak: “<a href="http://www.slideshare.net/SanderMak/eventsourced-architectures-with-akka">Event-Sourced Architectures with Akka</a>,” at <em>JavaOne</em>, September 2014.</li>
<li>Julian Hyde: <a href="https://twitter.com/julianhyde/status/743374145006641153">personal communication</a>, June 2016.</li>
<li>Ashish Gupta and Inderpal Singh Mumick: <em>Materialized Views: Techniques, Implementations, and Applications</em>. MIT Press, 1999. ISBN: 978-0-262-57122-7</li>
<li>Timothy Griffin and Leonid Libkin: “<a href="http://homepages.inf.ed.ac.uk/libkin/papers/sigmod95.pdf">Incremental Maintenance of Views with Duplicates</a>,” at <em>ACM International Conference on Management of Data</em> (SIGMOD), May 1995. <a href="http://dx.doi.org/10.1145/223784.223849">doi:10.1145/223784.223849</a></li>
<li>Pat Helland: “<a href="http://www.cidrdb.org/cidr2015/Papers/CIDR15_Paper16.pdf">Immutability Changes Everything</a>,” at <em>7th Biennial Conference on Innovative Data Systems Research</em> (CIDR), January 2015.</li>
<li>Martin Kleppmann: “<a href="http://martin.kleppmann.com/2011/03/07/accounting-for-computer-scientists.html">Accounting for Computer Scientists</a>,” <em>martin.kleppmann.com</em>, March 7, 2011.</li>
<li>Pat Helland: “<a href="https://blogs.msdn.microsoft.com/pathelland/2007/06/14/accountants-dont-use-erasers/">Accountants Don't Use Erasers</a>,” <em>blogs.msdn.com</em>, June 14, 2007.</li>
<li>Fangjin Yang: “<a href="https://metamarkets.com/2015/dogfooding-with-druid-samza-and-kafka-metametrics-at-metamarkets/">Dogfooding with Druid, Samza, and Kafka: Metametrics at Metamarkets</a>,” <em>metamarkets.com</em>, June 3, 2015.</li>
<li>Gavin Li, Jianqiu Lv, and Hang Qi: “<a href="http://yahoohadoop.tumblr.com/post/116365275781/pistachio-co-locate-the-data-and-compute-for">Pistachio: Co-Locate the Data and Compute for Fastest Cloud Compute</a>,” <em>yahoohadoop.tumblr.com</em>, April 13, 2015.</li>
<li>Kartik Paramasivam: “<a href="https://engineering.linkedin.com/blog/2016/06/stream-processing-hard-problems-part-1-killing-lambda">Stream Processing Hard Problems – Part 1: Killing Lambda</a>,” <em>engineering.linkedin.com</em>, June 27, 2016.</li>
<li>Martin Fowler: “<a href="http://martinfowler.com/bliki/CQRS.html">CQRS</a>,” <em>martinfowler.com</em>, July 14, 2011.</li>
<li>Greg Young: “<a href="https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf">CQRS Documents</a>,” <em>cqrs.files.wordpress.com</em>, November 2010.</li>
<li>Baron Schwartz: “<a href="http://www.xaprb.com/blog/2013/12/28/immutability-mvcc-and-garbage-collection/">Immutability, MVCC, and Garbage Collection</a>,” <em>xaprb.com</em>, December 28, 2013.</li>
<li>Daniel Eloff, Slava Akhmechet, Jay Kreps, et al.: <a href="https://news.ycombinator.com/item?id=9145197">"Re: Turning the Database Inside-out with Apache Samza</a>," <em>Hacker News discussion, news.ycombinator.com</em>, March 4, 2015.</li>
<li>“<a href="http://docs.datomic.com/excision.html">Datomic Development Resources: Excision</a>,” Cognitect, Inc., <em>docs.datomic.com</em>.</li>
<li>“<a href="http://fossil-scm.org/index.html/doc/trunk/www/shunning.wiki">Fossil Documentation: Deleting Content from Fossil</a>,” <em>fossil-scm.org</em>, 2016.</li>
<li>Jay Kreps: “<a href="https://twitter.com/jaykreps/status/582580836425330688">The irony of distributed systems is that data loss is really easy but deleting data is surprisingly hard,</a>” <em>twitter.com</em>, March 30, 2015.</li>
<li>David C. Luckham: “<a href="http://www.complexevents.com/2006/08/01/what’s-the-difference-between-esp-and-cep/">What’s the Difference Between ESP and CEP?</a>,” <em>complexevents.com</em>, August 1, 2006.</li>
<li>Srinath Perera: “<a href="https://www.quora.com/How-is-stream-processing-and-complex-event-processing-CEP-different">How Is Stream Processing and Complex Event Processing (CEP) Different?</a>,” <em>quora.com</em>, December 3, 2015.</li>
<li>Arvind Arasu, Shivnath Babu, and Jennifer Widom: “<a href="http://research.microsoft.com/pubs/77607/cql.pdf">The CQL Continuous Query Language: Semantic Foundations and Query Execution</a>,” <em>The VLDB Journal</em>, volume 15, number 2, pages 121–142, June 2006. <a href="http://dx.doi.org/10.1007/s00778-004-0147-z">doi:10.1007/s00778-004-0147-z</a></li>
<li>Julian Hyde: “<a href="http://queue.acm.org/detail.cfm?id=1667562">Data in Flight: How Streaming SQL Technology Can Help Solve the Web 2.0 Data Crunch</a>,” <em>ACM Queue</em>, volume 7, number 11, December 2009. <a href="http://dx.doi.org/10.1145/1661785.1667562">doi:10.1145/1661785.1667562</a></li>
<li>“<a href="http://www.espertech.com/esper/release-5.4.0/esper-reference/html_single/index.html">Esper Reference, Version 5.4.0</a>,” EsperTech, Inc., <em>espertech.com</em>, April 2016.</li>
<li>Zubair Nabi, Eric Bouillet, Andrew Bainbridge, and Chris Thomas: “<a href="https://developer.ibm.com/streamsdev/wp-content/uploads/sites/15/2014/04/Streams-and-Storm-April-2014-Final.pdf">Of Streams and Storms</a>,” IBM technical report, <em>developer.ibm.com</em>, April 2014.</li>
<li>Milinda Pathirage, Julian Hyde, Yi Pan, and Beth Plale: “<a href="https://github.com/milinda/samzasql-hpbdc2016/blob/master/samzasql-hpbdc2016.pdf">SamzaSQL: Scalable Fast Data Management with Streaming SQL</a>,” at <em>IEEE International Workshop on High-Performance Big Data Computing</em> (HPBDC), May 2016. <a href="http://dx.doi.org/10.1109/IPDPSW.2016.141">doi:10.1109/IPDPSW.2016.141</a></li>
<li>Philippe Flajolet, Éric Fusy, Olivier Gandouet, and Frédéric Meunier: “<a href="http://algo.inria.fr/flajolet/Publications/FlFuGaMe07.pdf">HyperLo⁠gLog: The Analysis of a Near-Optimal Cardinality Estimation Algorithm</a>,” at <em>Conference on Analysis of Algorithms</em> (AofA), June 2007.</li>
<li>Jay Kreps: “<a href="https://www.oreilly.com/ideas/questioning-the-lambda-architecture">Questioning the Lambda Architecture</a>,” <em>oreilly.com</em>, July 2, 2014.</li>
<li>Ian Hellström: “<a href="https://databaseline.wordpress.com/2016/03/12/an-overview-of-apache-streaming-technologies/">An Overview of Apache Streaming Technologies</a>,” <em>databaseline.wordpress.com</em>, March 12, 2016.</li>
<li>Jay Kreps: “<a href="https://www.oreilly.com/ideas/why-local-state-is-a-fundamental-primitive-in-stream-processing">Why Local State Is a Fundamental Primitive in Stream Processing</a>,” <em>oreilly.com</em>, July 31, 2014.</li>
<li>Shay Banon: “<a href="https://www.elastic.co/blog/percolator">Percolator</a>,” <em>elastic.co</em>, February 8, 2011.</li>
<li>Alan Woodward and Martin Kleppmann: “<a href="http://martin.kleppmann.com/2015/04/13/real-time-full-text-search-luwak-samza.html">Real-Time Full-Text Search with Luwak and Samza</a>,” <em>martin.kleppmann.com</em>, April 13, 2015.</li>
<li>“<a href="https://storm.apache.org/releases/1.0.1/index.html">Apache Storm 1.0.1 Documentation</a>,” <em>storm.apache.org</em>, May 2016.</li>
<li>Tyler Akidau: “<a href="https://www.oreilly.com/ideas/the-world-beyond-batch-streaming-102">The World Beyond Batch: Streaming 102</a>,” <em>oreilly.com</em>, January 20, 2016.</li>
<li>Stephan Ewen: “<a href="http://www.confluent.io/kafka-summit-2016-systems-advanced-streaming-analytics-with-apache-flink-and-apache-kafka">Streaming Analytics with Apache Flink</a>,” at <em>Kafka Summit</em>, April 2016.</li>
<li>Tyler Akidau, Alex Balikov, Kaya Bekiroğlu, et al.: “<a href="http://research.google.com/pubs/pub41378.html">MillWheel: Fault-Tolerant Stream Processing at Internet Scale</a>,” at <em>39th International Conference on Very Large Data Bases</em> (VLDB), August 2013.</li>
<li>Alex Dean: “<a href="http://snowplowanalytics.com/blog/2015/09/15/improving-snowplows-understanding-of-time/">Improving Snowplow's Understanding of Time</a>,” <em>snowplowanalytics.com</em>, September 15, 2015.</li>
<li>“<a href="https://msdn.microsoft.com/en-us/library/azure/dn835019.aspx">Windowing (Azure Stream Analytics)</a>,” Microsoft Azure Reference, <em>msdn.microsoft.com</em>, April 2016.</li>
<li>“<a href="http://samza.apache.org/learn/documentation/0.10/container/state-management.html">State Management</a>,” Apache Samza 0.10 Documentation, <em>samza.apache.org</em>, December 2015.</li>
<li>Rajagopal Ananthanarayanan, Venkatesh Basker, Sumit Das, et al.: “<a href="http://research.google.com/pubs/pub41318.html">Photon: Fault-Tolerant and Scalable Joining of Continuous Data Streams</a>,” at <em>ACM International Conference on Management of Data</em> (SIGMOD), June 2013. <a href="http://dx.doi.org/10.1145/2463676.2465272">doi:10.1145/2463676.2465272</a></li>
<li>Martin Kleppmann: “<a href="https://github.com/ept/newsfeed">Samza Newsfeed Demo</a>,” <em>github.com</em>, September 2014.</li>
<li>Ben Kirwin: “<a href="http://ben.kirw.in/2014/11/28/kafka-patterns/">Doing the Impossible: Exactly-Once Messaging Patterns in Kafka</a>,” <em>ben.kirw.in</em>, November 28, 2014.</li>
<li>Pat Helland: “<a href="http://cidrdb.org/cidr2005/papers/P12.pdf">Data on the Outside Versus Data on the Inside</a>,” at <em>2nd Biennial Conference on Innovative Data Systems Research</em> (CIDR), January 2005.</li>
<li>Ralph Kimball and Margy Ross: <em>The Data Warehouse Toolkit: The Definitive Guide to Dimensional Modeling</em>, 3rd edition. John Wiley &amp; Sons, 2013. ISBN: 978-1-118-53080-1</li>
<li>Viktor Klang: “<a href="https://twitter.com/viktorklang/status/789036133434978304">I'm coining the phrase 'effectively-once' for message processing with at-least-once + idempotent operations</a>,” <em>twitter.com</em>, October 20, 2016.</li>
<li>Matei Zaharia, Tathagata Das, Haoyuan Li, et al.: “<a href="https://www.usenix.org/system/files/conference/hotcloud12/hotcloud12-final28.pdf">Discretized Streams: An Efficient and Fault-Tolerant Model for Stream Processing on Large Clusters</a>,” at <em>4th USENIX Conference in Hot Topics in Cloud Computing</em> (HotCloud), June 2012.</li>
<li>Kostas Tzoumas, Stephan Ewen, and Robert Metzger: “<a href="http://data-artisans.com/high-throughput-low-latency-and-exactly-once-stream-processing-with-apache-flink/">High-Throughput, Low-Latency, and Exactly-Once Stream Processing with Apache Flink</a>,” <em>data-artisans.com</em>, August 5, 2015.</li>
<li>Paris Carbone, Gyula Fóra, Stephan Ewen, et al.: “<a href="http://arxiv.org/abs/1506.08603">Lightweight Asynchronous Snapshots for Distributed Dataflows</a>,” arXiv:1506.08603 [cs.DC], June 29, 2015.</li>
<li>Ryan Betts and John Hugg: <a href="http://www.oreilly.com/data/free/fast-data-smart-and-at-scale.csp"><em>Fast Data: Smart and at Scale</em></a>. Report, O'Reilly Media, October 2015.</li>
<li>Flavio Junqueira: “<a href="http://conferences.oreilly.com/strata/hadoop-big-data-eu/public/schedule/detail/49690">Making Sense of Exactly-Once Semantics</a>,” at <em>Strata+Hadoop World London</em>, June 2016.</li>
<li>Jason Gustafson, Flavio Junqueira, Apurva Mehta, Sriram Subramanian, and Guozhang Wang: “<a href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-98+-+Exactly+Once+Delivery+and+Transactional+Messaging">KIP-98 – Exactly Once Delivery and Transactional Messaging</a>,” <em>cwiki.apache.org</em>, November 2016.</li>
<li>Pat Helland: “<a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.401.1539&amp;rep=rep1&amp;type=pdf">Idempotence Is Not a Medical Condition</a>,” <em>Communications of the ACM</em>, volume 55, number 5, page 56, May 2012. <a href="http://dx.doi.org/10.1145/2160718.2160734">doi:10.1145/2160718.2160734</a></li>
<li>Jay Kreps: “<a href="http://mail-archives.apache.org/mod_mbox/samza-dev/201409.mbox/">Re: Trying to Achieve Deterministic Behavior on Recovery/Rewind</a>,” email to <em>samza-dev</em> mailing list, September 9, 2014.</li>
<li>E. N. (Mootaz) Elnozahy, Lorenzo Alvisi, Yi-Min Wang, and David B. Johnson: “<a href="http://www.cs.utexas.edu/~lorenzo/papers/SurveyFinal.pdf">A Survey of Rollback-Recovery Protocols in Message-Passing Systems</a>,” <em>ACM Computing Surveys</em>, volume 34, number 3, pages 375–408, September 2002. <a href="http://dx.doi.org/10.1145/568522.568525">doi:10.1145/568522.568525</a></li>
<li>Adam Warski: “<a href="https://softwaremill.com/kafka-streams-how-does-it-fit-stream-landscape/">Kafka Streams – How Does It Fit the Stream Processing Landscape?</a>,” <em>softwaremill.com</em>, June 1, 2016.</li>
</ol>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>要设计一种负载均衡方案也是有可能的，在这种方案中，两个消费者通过读取全部消息来共享分区处理的工作，但是其中一个只考虑具有偶数偏移量的消息，而另一个消费者只处理奇数编号的偏移量。或者你可以将消息摊到一个线程池中来处理，但这种方法会使消费者偏移量管理变得复杂。一般来说，单线程处理单分区是合适的，可以通过增加更多分区来提高并行度。&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>如果你将流视作表的衍生物，如 <a href="pics/fig11-6.png">图 11-6</a> 所示，而把一个连接看作是两个表的乘法u·v，那么会发生一些有趣的事情：物化连接的变化流遵循乘积法则：(u·v)'= u'v + uv'。换句话说，任何推文的变化量都与当前的关注联系在一起，任何关注的变化量都与当前的推文相连接【49,50】。&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="10_batch_processing.html" class="md-footer__link md-footer__link--prev" aria-label="上一页: 第十章：批处理">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                第十章：批处理
              </div>
            </div>
          </a>
        
        
          
          <a href="12_the_future.html" class="md-footer__link md-footer__link--next" aria-label="下一页: 第十二章：数据系统的未来">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                第十二章：数据系统的未来
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.footer", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../.mkdocs/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>